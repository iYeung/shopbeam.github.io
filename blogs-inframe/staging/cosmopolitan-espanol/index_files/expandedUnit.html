<!DOCTYPE html>
<!-- saved from url=(0931)http://as.jivox.com/player/expandedUnit.php?expandAsInterstitial=1&t=1380317264318&r=0.4445457870606333&creativeUnitType=8&creativeUnitWidth=640&creativeUnitHeight=480&siteId=2521715ca13bed&campaignId=47863&clickTagURL=http%3A%2F%2Fadclick.g.doubleclick.net%2Faclk%3Fsa%3DL%26ai%3DB4Z7GUPhFUpLQE-vP0AG93ICIDaqowo0EAAAAEAEgwqCnDjgAWOqL5uphYMnGqYvApNgPsgEWd3d3LmNvc21vZW5lc3Bhbm9sLmNvbboBCzAwZ2ZwX2ltYWdlyAEJ2gEmaHR0cDovL3d3dy5jb3Ntb2VuZXNwYW5vbC5jb20vZmFzaGlvbi-pAo2ngfDMYXQ-wAIC4AIA6gI-LzcxODcvdGVsZXZpc2EuZWRpdG9yaWFsLmNvc21vZW5lc3Bhbm9sL2Nvc21vZW5lc3Bhbm9sLmZhc2hpb274AoHSHpAD4AOYA6QDqAMB0ASQTuAEAaAGIA%26num%3D0%26sig%3DAOD64_1auFdJJrgb5qh-EFPUxfZCfZCLWw%26client%3Dca-pub-7798366957477628%26adurl%3Dhttp%3A%2F%2Fwww.MiPantene.com&objectName=jvxAdPlayer_5245f850874f99_49863897&creativeUnitType=14&lDim=640x480&expandUnitType=&adUnitType=9&expandedUnit=1&viewLayout=&adUnitWidth=640&adUnitHeight=480&jvxSessionId=1380317264.9409 -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Jivox Interactivity Ad Framework</title>


<style>
#mask{position: absolute;top: 0;left: 0;width: 100%;height: 100%;background: #FFFFFF repeat scroll 0 0;display: none;z-index: 9999999990;filter:alpha(opacity=60); -moz-opacity:0.6; -khtml-opacity: 0.6; opacity: 0.6;}

p.loading{margin: 120px; font-family: arial, verdana, tahoma; font-size: 11px; color: #085258;}
/* container */
div.related-tweets{ }
/* inner div */
div.rrt-inner{#width:160px; padding:4px; overflow:hidden; font-family: arial, verdana, tahoma; font-size: 11px; color: #085258; margin: 25% 20%;  #margin: 25% 18%;}
/* ul list */
div.rrt-inner ul{float:left; padding:0 0 0 0; margin:0 0 0 0;}
div.rrt-inner li{float:left; margin:0 0 0 0; list-style-type:none; position:relative;}
/* author img */
div.rrt-inner span.rrt-author-img{} 
/* author name */
div.rrt-inner strong a{}
/* tweet body */
div.rrt-inner span.rrt-body {display:block;}
/* tweet content */
div.rrt-inner span.rrt-content{}

/* tweet date and source line */
div.rrt-inner span.rrt-meta {color:#999999; display:block; font-size:11px; margin:3px 0 0;}
div.rrt-inner span.rrt-meta a{ color: #0C717A; text-decoration:none;}
div.rrt-inner span.rrt-meta a:hover{color: #0C717A; text-decoration:underline;}
/* customize date link */
div.rrt-inner a.rrt-date { }
/* customize source link */
div.rrt-inner a.rrt-source { }

/* customize links */
div.rrt-inner a.rrt-link {color: #0C717A; }
/* customize @user links */
div.rrt-inner a.rrt-at {color: #0C717A; }
/* customize #hashtags links */
div.rrt-inner a.rrt-hashtag { color: #0C717A; }
.rrt-source{display:none;}

.shadow {
-moz-box-shadow: 4px 4px 3px #000;
-webkit-box-shadow: 4px 4px 3px #000;
box-shadow: 4px 4px 3px #000;
}
.closeSecondaryVideo{cursor:pointer; padding:0px; position: absolute !important; right:0px; bottom:0px; z-index:9999999999; display:none;height:24px; width:24px;background: url('http://as.jivox.com/advertiser/images/close_24x24.png');}   
.backToVideo{position: absolute !important;right:0px;bottom:0px;padding:0px;height:32px;width:36px;background:url('http://as.jivox.com/advertiser/images/Back_To_Video.png')}
body.landscape640x480scene-1 .scenesContainer{background:url('http://cdn.jivox.com/47863/3/24238-61686-pro-522a47953215a.jpg') no-repeat scroll 0 0 #000000;margin:0px; padding:0px; height:480px; width:640px;} body.landscape640x480scene-1{background:#000000;margin:0px; padding:0px; height:480px; width:640px;}.landscape640x480scene-1 .baseContainer{ height:480px; width:640px; } .landscape640x480scene-1 .scenesContainer #custom104{position:absolute;left:542px;top:190px;width:19px;height:18px;z-index:2;} 

.landscape640x480scene-1 .scenesContainer #custom105{position:absolute;left:376px;top:190px;width:160px;height:18px;z-index:2;} 

.landscape640x480scene-1 .scenesContainer #custom106{position:absolute;left:192px;top:103px;width:123px;height:69px;z-index:2;} 

.landscape640x480scene-1 .scenesContainer #custom107{position:absolute;left:192px;top:22px;width:123px;height:69px;z-index:2;} 

.landscape640x480scene-1 .scenesContainer #custom110{position:absolute;left:0px;top:441px;width:186px;height:33px;z-index:2;} 

.landscape640x480scene-1 .scenesContainer #custom111{position:absolute;left:326px;top:11px;width:301px;height:170px;z-index:2;} 


</style>  

<script type="text/javascript" src="swfobject.js"></script>
<script type="text/javascript" src="jquery-1.7.2.min.js"></script>
</head>
<body class="landscape640x480scene-1">
<div id="eventHandler" style="position:absolute; top:-1000px; left:-1000px;">&nbsp;</div>
<div id="mask"></div>
<div class="scenesContainer">
<iframe id="actionBtnLaunchPad" frameborder="0" scrolling="no" style="background-color:#000000;position:absolute;z-index:9999999998;display:none;" src="blank.html"></iframe>
<div style="padding:0px; margin:0px; border:0px; position:absolute;cursor:pointer;z-index:9999999999;display:none; filter:alpha(opacity=80); -moz-opacity:0.8; -khtml-opacity: 0.8; opacity: 0.8; font-family:arial, tahoma; letter-spacing:0px; line-height:1; text-transform:none;right:0px;height:24px; width:24px;background: url(&#39;http://as.jivox.com/advertiser/images/close_24x24.png&#39;);" id="closeActionBtnLaunchPad" name="closeActionBtnLaunchPad"></div>

<div class="baseContainer" style="cursor:pointer;"></div>
<script language="javascript" type="text/javascript">
var syncUnitLoad = 0;
var isMSIE = !!eval("/*@cc_on!@*/false");
var flashplugin = (navigator.mimeTypes && navigator.mimeTypes["application/x-shockwave-flash"]) ? navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin : 0;

var expandUnitOpen = false;

if(!flashplugin && isMSIE){
	// if we are here, this is for MSIE only.
	try {
		flashObj = new ActiveXObject('ShockwaveFlash.ShockwaveFlash');
		if(flashObj)
			flashplugin = true;
	} catch (ex) {
	}
}

if(!flashplugin){ // if flash support is not there, turn off sync unit load
	syncUnitLoad = 0;
}

function attachEventListener(target, eventType, functionRef, capture){
	if(typeof target.addEventListener != "undefined")
	{
		target.addEventListener(eventType, functionRef, capture);
	}else{
		target.attachEvent("on" + eventType, functionRef);
	}
}

// pass the object width and height that you want to center align in the window. Returns X,Y coordinates with center alignment
function getCenterAlignXY(objWidth,objHeight){ 
	 var objX =  ($(window).width() - objWidth) / 2 ;
	 var objY =  ($(window).height() - objHeight) / 2 ;
	 return [objX,objY];
}

var actionButtonEventId = '';
var actionBtnTimeElapsed = 0;
var sceneTimeElapsed = 0;
var actionBtnPanelTimer = null;
var sceneTimer = null;
var adUnitWidth = 640;
var defaultOutputWinWidth = parseInt(adUnitWidth) - 100;
var adUnitHeight = 480;
var defaultOutputWinHeight = parseInt(adUnitHeight) - 100;
var outputWindowType = 'default';

var transformScaleApplied = false;
var initialOrientationPlayerWidth = 300;
var initialOrientationPlayerHeight = 250;
var	sceneTransition = false; // handling multiple clicks one after another on the scene navigation buttons

var isInterstitial = false;

var videoElementsInScene = {}; //stores the video element ids for current scene
var activeVideoIdInScene = "";
var prevOrientActiveVideoIdInScene = "";
var currOrientActiveVideoIdInScene = "";
var playerWidth = 300;
var playerHeight = 250;
var isPlayerInLayoutScene = true;
var isInPlaceVideoInScene = false;
var isInPlaceVideoPaused = false;
var inPlaceVideoId = null;
var inplaceVideoAutoPlay = false;
var adUnitTypeStr = 'inbanner';
var globalLayoutAreaJSON = {"640x480":307200};
var actionButtonsJSON = {"customInteraction.custom101":{"interactionIdentifier":"customInteraction.custom101","icon":"http:\/\/cdn.jivox.com\/47863\/3\/24238-0-ivd521f88af174a3-tn.jpg","label":"inplace1","data":"http:\/\/cdn.jivox.com\/47863\/3\/WP1_24238_47863_61854_1400620406.mp4","externalPostURL":null,"eventType":"101","iconFileName":"default-video-thumbnail.png","urlFileName":"Maite, Behind the Music Video FINAL High Res.flv","showInInteractNowBar":null,"type":"inline-video","orderNumber":1,"paramString":null,"secondaryVideoURL":"http:\/\/jivoxassets.s3.amazonaws.com\/asset\/2013\/8\/24238-0-ivd521f88af174a3-in.flv","adFormat":"180","toEmailLabel":null,"fromEmailLabel":null,"messageLabel":null,"phoneRecipientLabel":null,"fromNameLabel":null,"postInteractionLaunchURL":null,"brandAwarenessLevel":"2","facebookUrlType":null,"isActionButton":"1","iconDimension":"[340,192]","assetDimension":"[340,192]","origIconDimension":null,"origAssetDimension":null,"assetBgColor":null,"iconBgColor":null,"iconFileType":"image","isIconActivePanel":null,"iconParamString":null,"autoPlay":"0","iconGlowColor":null,"isIconBgTransparent":null,"isWatermarkLogo":null,"fallbackImgURL":null,"fallbackImgFileName":null,"shareUrlType":null,"shareMsg":null,"fallbackType":null,"fallbackWidgetSrc":null,"fallbackWidgetURL":null,"fallbackWidgetFileName":null,"isCreatedByWidget":null,"swfClickHandler":null,"iconCustomEventQueryStr":null,"actionCustomEventQueryStr":null},"customInteraction.custom102":{"interactionIdentifier":"customInteraction.custom102","icon":"http:\/\/cdn.jivox.com\/47863\/3\/24238-0-ivd521f8a0b7d6d0-tn.jpg","label":"inplace2","data":"http:\/\/cdn.jivox.com\/47863\/3\/WP1_24238_47863_61854_-898460468.mp4","externalPostURL":null,"eventType":"102","iconFileName":"default-video-thumbnail.png","urlFileName":"Maite, Morning Routine FINAL Pantene Mention High res(1).flv","showInInteractNowBar":null,"type":"inline-video","orderNumber":2,"paramString":null,"secondaryVideoURL":"http:\/\/jivoxassets.s3.amazonaws.com\/asset\/2013\/8\/24238-0-ivd521f8a0b7d6d0-in.flv","adFormat":"180","toEmailLabel":null,"fromEmailLabel":null,"messageLabel":null,"phoneRecipientLabel":null,"fromNameLabel":null,"postInteractionLaunchURL":null,"brandAwarenessLevel":"2","facebookUrlType":null,"isActionButton":"1","iconDimension":"[340,192]","assetDimension":"[340,192]","origIconDimension":null,"origAssetDimension":null,"assetBgColor":null,"iconBgColor":null,"iconFileType":"image","isIconActivePanel":null,"iconParamString":null,"autoPlay":"0","iconGlowColor":null,"isIconBgTransparent":null,"isWatermarkLogo":null,"fallbackImgURL":null,"fallbackImgFileName":null,"shareUrlType":null,"shareMsg":null,"fallbackType":null,"fallbackWidgetSrc":null,"fallbackWidgetURL":null,"fallbackWidgetFileName":null,"isCreatedByWidget":null,"swfClickHandler":null,"iconCustomEventQueryStr":null,"actionCustomEventQueryStr":null},"customInteraction.custom103":{"interactionIdentifier":"customInteraction.custom103","icon":"http:\/\/cdn.jivox.com\/47863\/3\/24238-61450-pro-521fbf257b152.png","label":"mask","data":null,"externalPostURL":null,"eventType":"103","iconFileName":"Pantene_640x480_mask.png","urlFileName":null,"showInInteractNowBar":null,"type":"no-action","orderNumber":3,"paramString":null,"secondaryVideoURL":null,"adFormat":null,"toEmailLabel":null,"fromEmailLabel":null,"messageLabel":null,"phoneRecipientLabel":null,"fromNameLabel":null,"postInteractionLaunchURL":null,"brandAwarenessLevel":"2","facebookUrlType":null,"isActionButton":"1","iconDimension":"[640,480]","assetDimension":null,"origIconDimension":"[640,480]","origAssetDimension":null,"assetBgColor":null,"iconBgColor":null,"iconFileType":"image","isIconActivePanel":null,"iconParamString":null,"autoPlay":"1","iconGlowColor":null,"isIconBgTransparent":"0","isWatermarkLogo":null,"fallbackImgURL":null,"fallbackImgFileName":null,"shareUrlType":null,"shareMsg":null,"fallbackType":null,"fallbackWidgetSrc":null,"fallbackWidgetURL":null,"fallbackWidgetFileName":null,"isCreatedByWidget":null,"swfClickHandler":null,"iconCustomEventQueryStr":null,"actionCustomEventQueryStr":null},"customInteraction.custom104":{"interactionIdentifier":"customInteraction.custom104","icon":"http:\/\/cdn.jivox.com\/47863\/3\/24238-0-pro-521f8d41e2be0.png","label":"twit","data":"https:\/\/twitter.com\/Pantene","externalPostURL":null,"eventType":"104","iconFileName":"twitter.png","urlFileName":null,"showInInteractNowBar":null,"type":"url","orderNumber":4,"paramString":null,"secondaryVideoURL":null,"adFormat":null,"toEmailLabel":null,"fromEmailLabel":null,"messageLabel":null,"phoneRecipientLabel":null,"fromNameLabel":null,"postInteractionLaunchURL":null,"brandAwarenessLevel":"2","facebookUrlType":null,"isActionButton":"1","iconDimension":"[19,18]","assetDimension":null,"origIconDimension":"[19,18]","origAssetDimension":null,"assetBgColor":null,"iconBgColor":null,"iconFileType":"image","isIconActivePanel":null,"iconParamString":null,"autoPlay":"1","iconGlowColor":null,"isIconBgTransparent":"0","isWatermarkLogo":null,"fallbackImgURL":null,"fallbackImgFileName":null,"shareUrlType":null,"shareMsg":null,"fallbackType":null,"fallbackWidgetSrc":null,"fallbackWidgetURL":null,"fallbackWidgetFileName":null,"isCreatedByWidget":null,"swfClickHandler":null,"iconCustomEventQueryStr":null,"actionCustomEventQueryStr":null},"customInteraction.custom105":{"interactionIdentifier":"customInteraction.custom105","icon":"http:\/\/cdn.jivox.com\/47863\/3\/24238-0-pro-521f8d61825b4.png","label":"fb","data":"https:\/\/www.facebook.com\/PanteneNA?sk=app_141613842573794","externalPostURL":null,"eventType":"105","iconFileName":"fb.png","urlFileName":null,"showInInteractNowBar":null,"type":"url","orderNumber":5,"paramString":null,"secondaryVideoURL":null,"adFormat":null,"toEmailLabel":null,"fromEmailLabel":null,"messageLabel":null,"phoneRecipientLabel":null,"fromNameLabel":null,"postInteractionLaunchURL":null,"brandAwarenessLevel":"2","facebookUrlType":null,"isActionButton":"1","iconDimension":"[160,18]","assetDimension":null,"origIconDimension":"[160,18]","origAssetDimension":null,"assetBgColor":null,"iconBgColor":null,"iconFileType":"image","isIconActivePanel":null,"iconParamString":null,"autoPlay":"1","iconGlowColor":null,"isIconBgTransparent":"0","isWatermarkLogo":null,"fallbackImgURL":null,"fallbackImgFileName":null,"shareUrlType":null,"shareMsg":null,"fallbackType":null,"fallbackWidgetSrc":null,"fallbackWidgetURL":null,"fallbackWidgetFileName":null,"isCreatedByWidget":null,"swfClickHandler":null,"iconCustomEventQueryStr":null,"actionCustomEventQueryStr":null},"customInteraction.custom106":{"interactionIdentifier":"customInteraction.custom106","icon":"http:\/\/cdn.jivox.com\/47863\/3\/24238-61450-pro-521fa50d975f5.jpg","label":"vid1","data":"http:\/\/cdn.jivox.com\/47863\/3\/WP1_24238_47863_61854_-853585707.mp4","externalPostURL":null,"eventType":"106","iconFileName":"vidicon_2.jpg","urlFileName":"Maite, Morning Routine FINAL Pantene Mention High res(1).flv","showInInteractNowBar":null,"type":"video","orderNumber":6,"paramString":null,"secondaryVideoURL":"http:\/\/jivoxassets.s3.amazonaws.com\/asset\/2013\/8\/24238-61450-ivd521f917492938-in.flv","adFormat":"180","toEmailLabel":null,"fromEmailLabel":null,"messageLabel":null,"phoneRecipientLabel":null,"fromNameLabel":null,"postInteractionLaunchURL":null,"brandAwarenessLevel":"2","facebookUrlType":null,"isActionButton":"1","iconDimension":"[123,69]","assetDimension":"[340,192]","origIconDimension":"[123,69]","origAssetDimension":null,"assetBgColor":null,"iconBgColor":null,"iconFileType":"image","isIconActivePanel":null,"iconParamString":null,"autoPlay":"1","iconGlowColor":null,"isIconBgTransparent":"0","isWatermarkLogo":null,"fallbackImgURL":null,"fallbackImgFileName":null,"shareUrlType":null,"shareMsg":null,"fallbackType":null,"fallbackWidgetSrc":null,"fallbackWidgetURL":null,"fallbackWidgetFileName":null,"isCreatedByWidget":null,"swfClickHandler":null,"iconCustomEventQueryStr":null,"actionCustomEventQueryStr":null},"customInteraction.custom107":{"interactionIdentifier":"customInteraction.custom107","icon":"http:\/\/cdn.jivox.com\/47863\/3\/24238-61450-pro-521fa517bf08a.jpg","label":"vid2","data":"http:\/\/cdn.jivox.com\/47863\/3\/WP1_24238_47863_61854_-1172807613.mp4","externalPostURL":null,"eventType":"107","iconFileName":"vidicon_1.jpg","urlFileName":"Maite, Behind the Music Video FINAL High Res.flv","showInInteractNowBar":null,"type":"video","orderNumber":7,"paramString":null,"secondaryVideoURL":"http:\/\/jivoxassets.s3.amazonaws.com\/asset\/2013\/8\/24238-61450-ivd521fa1e4f27ff-in.flv","adFormat":"180","toEmailLabel":null,"fromEmailLabel":null,"messageLabel":null,"phoneRecipientLabel":null,"fromNameLabel":null,"postInteractionLaunchURL":null,"brandAwarenessLevel":"2","facebookUrlType":null,"isActionButton":"1","iconDimension":"[123,69]","assetDimension":"[340,192]","origIconDimension":"[123,69]","origAssetDimension":null,"assetBgColor":null,"iconBgColor":null,"iconFileType":"image","isIconActivePanel":null,"iconParamString":null,"autoPlay":"1","iconGlowColor":null,"isIconBgTransparent":"0","isWatermarkLogo":null,"fallbackImgURL":null,"fallbackImgFileName":null,"shareUrlType":null,"shareMsg":null,"fallbackType":null,"fallbackWidgetSrc":null,"fallbackWidgetURL":null,"fallbackWidgetFileName":null,"isCreatedByWidget":null,"swfClickHandler":null,"iconCustomEventQueryStr":null,"actionCustomEventQueryStr":null},"customInteraction.custom108":{"interactionIdentifier":"customInteraction.custom108","icon":"http:\/\/cdn.jivox.com\/47863\/3\/24238-61450-pro-521fb83a11674.png","label":"vid1-inter","data":"http:\/\/cdn.jivox.com\/47863\/3\/WP1_24238_47863_61854_715619794.mp4","externalPostURL":null,"eventType":"108","iconFileName":"ivid_icon1_inter.png","urlFileName":"Maite, Behind the Music Video FINAL High Res.flv","showInInteractNowBar":null,"type":"video","orderNumber":8,"paramString":null,"secondaryVideoURL":"http:\/\/jivoxassets.s3.amazonaws.com\/asset\/2013\/8\/24238-61450-ivd521fb861e1285-in.flv","adFormat":"180","toEmailLabel":null,"fromEmailLabel":null,"messageLabel":null,"phoneRecipientLabel":null,"fromNameLabel":null,"postInteractionLaunchURL":null,"brandAwarenessLevel":"2","facebookUrlType":null,"isActionButton":"1","iconDimension":"[123,69]","assetDimension":"[340,192]","origIconDimension":"[123,69]","origAssetDimension":null,"assetBgColor":null,"iconBgColor":null,"iconFileType":"image","isIconActivePanel":null,"iconParamString":null,"autoPlay":"1","iconGlowColor":null,"isIconBgTransparent":"0","isWatermarkLogo":null,"fallbackImgURL":null,"fallbackImgFileName":null,"shareUrlType":null,"shareMsg":null,"fallbackType":null,"fallbackWidgetSrc":null,"fallbackWidgetURL":null,"fallbackWidgetFileName":null,"isCreatedByWidget":null,"swfClickHandler":null,"iconCustomEventQueryStr":null,"actionCustomEventQueryStr":null},"customInteraction.custom109":{"interactionIdentifier":"customInteraction.custom109","icon":"http:\/\/cdn.jivox.com\/47863\/3\/24238-61450-pro-521fb8dc9128c.png","label":"vid2-inter","data":"http:\/\/cdn.jivox.com\/47863\/3\/WP1_24238_47863_61854_1570786628.mp4","externalPostURL":null,"eventType":"109","iconFileName":"ivid_icon2_inter.png","urlFileName":"Maite, Morning Routine FINAL Pantene Mention High res(1).flv","showInInteractNowBar":null,"type":"video","orderNumber":9,"paramString":null,"secondaryVideoURL":"http:\/\/jivoxassets.s3.amazonaws.com\/asset\/2013\/8\/24238-61450-ivd521fb90691103-in.flv","adFormat":"180","toEmailLabel":null,"fromEmailLabel":null,"messageLabel":null,"phoneRecipientLabel":null,"fromNameLabel":null,"postInteractionLaunchURL":null,"brandAwarenessLevel":"2","facebookUrlType":null,"isActionButton":"1","iconDimension":"[123,70]","assetDimension":"[340,192]","origIconDimension":"[123,70]","origAssetDimension":null,"assetBgColor":null,"iconBgColor":null,"iconFileType":"image","isIconActivePanel":null,"iconParamString":null,"autoPlay":"1","iconGlowColor":null,"isIconBgTransparent":"0","isWatermarkLogo":null,"fallbackImgURL":null,"fallbackImgFileName":null,"shareUrlType":null,"shareMsg":null,"fallbackType":null,"fallbackWidgetSrc":null,"fallbackWidgetURL":null,"fallbackWidgetFileName":null,"isCreatedByWidget":null,"swfClickHandler":null,"iconCustomEventQueryStr":null,"actionCustomEventQueryStr":null},"customInteraction.custom110":{"interactionIdentifier":"customInteraction.custom110","icon":"http:\/\/cdn.jivox.com\/47863\/3\/24238-61450-pro-521fc179d967a.png","label":"logo button","data":"http:\/\/www.Pantene.com\/espanol","externalPostURL":null,"eventType":"110","iconFileName":"invis_btn_rec.png","urlFileName":null,"showInInteractNowBar":null,"type":"url","orderNumber":10,"paramString":null,"secondaryVideoURL":null,"adFormat":null,"toEmailLabel":null,"fromEmailLabel":null,"messageLabel":null,"phoneRecipientLabel":null,"fromNameLabel":null,"postInteractionLaunchURL":null,"brandAwarenessLevel":"2","facebookUrlType":null,"isActionButton":"1","iconDimension":"[339,60]","assetDimension":null,"origIconDimension":"[339,60]","origAssetDimension":null,"assetBgColor":null,"iconBgColor":null,"iconFileType":"image","isIconActivePanel":null,"iconParamString":null,"autoPlay":"1","iconGlowColor":null,"isIconBgTransparent":"0","isWatermarkLogo":null,"fallbackImgURL":null,"fallbackImgFileName":null,"shareUrlType":null,"shareMsg":null,"fallbackType":null,"fallbackWidgetSrc":null,"fallbackWidgetURL":null,"fallbackWidgetFileName":null,"isCreatedByWidget":null,"swfClickHandler":null,"iconCustomEventQueryStr":null,"actionCustomEventQueryStr":null},"customInteraction.custom111":{"interactionIdentifier":"customInteraction.custom111","icon":"http:\/\/cdn.jivox.com\/47863\/3\/24238-61450-ivd522439b1f3bae-tn.jpg","label":"MainInPlaceVideo","data":"http:\/\/cdn.jivox.com\/47863\/3\/WP1_24238_47863_61854_1247867959.mp4","externalPostURL":null,"eventType":"111","iconFileName":"default-video-thumbnail.png","urlFileName":"Maite Studio TourFinal_001.flv","showInInteractNowBar":null,"type":"inline-video","orderNumber":11,"paramString":null,"secondaryVideoURL":"http:\/\/jivoxassets.s3.amazonaws.com\/asset\/2013\/9\/24238-61450-ivd522439b1f3bae-in.flv","adFormat":"180","toEmailLabel":null,"fromEmailLabel":null,"messageLabel":null,"phoneRecipientLabel":null,"fromNameLabel":null,"postInteractionLaunchURL":null,"brandAwarenessLevel":"2","facebookUrlType":null,"isActionButton":"1","iconDimension":"[340,192]","assetDimension":"[340,192]","origIconDimension":null,"origAssetDimension":null,"assetBgColor":null,"iconBgColor":null,"iconFileType":"image","isIconActivePanel":null,"iconParamString":null,"autoPlay":"1","iconGlowColor":null,"isIconBgTransparent":null,"isWatermarkLogo":null,"fallbackImgURL":null,"fallbackImgFileName":null,"shareUrlType":null,"shareMsg":null,"fallbackType":null,"fallbackWidgetSrc":null,"fallbackWidgetURL":null,"fallbackWidgetFileName":null,"isCreatedByWidget":null,"swfClickHandler":null,"iconCustomEventQueryStr":null,"actionCustomEventQueryStr":null},"customInteraction.custom112":{"interactionIdentifier":"customInteraction.custom112","icon":"http:\/\/cdn.jivox.com\/47863\/3\/24238-61532-pro-522612ebc3b1c.png","label":"leftedge","data":null,"externalPostURL":null,"eventType":"112","iconFileName":"leftedge.png","urlFileName":null,"showInInteractNowBar":null,"type":"no-action","orderNumber":12,"paramString":null,"secondaryVideoURL":null,"adFormat":null,"toEmailLabel":null,"fromEmailLabel":null,"messageLabel":null,"phoneRecipientLabel":null,"fromNameLabel":null,"postInteractionLaunchURL":null,"brandAwarenessLevel":"2","facebookUrlType":null,"isActionButton":"1","iconDimension":"[15,174]","assetDimension":null,"origIconDimension":"[15,174]","origAssetDimension":null,"assetBgColor":null,"iconBgColor":null,"iconFileType":"image","isIconActivePanel":null,"iconParamString":null,"autoPlay":"1","iconGlowColor":null,"isIconBgTransparent":"0","isWatermarkLogo":null,"fallbackImgURL":null,"fallbackImgFileName":null,"shareUrlType":null,"shareMsg":null,"fallbackType":null,"fallbackWidgetSrc":null,"fallbackWidgetURL":null,"fallbackWidgetFileName":null,"isCreatedByWidget":null,"swfClickHandler":null,"iconCustomEventQueryStr":null,"actionCustomEventQueryStr":null},"customInteraction.custom113":{"interactionIdentifier":"customInteraction.custom113","icon":"http:\/\/cdn.jivox.com\/47863\/3\/24238-61532-pro-522612fb027d1.png","label":"rightedge","data":null,"externalPostURL":null,"eventType":"113","iconFileName":"rightedge.png","urlFileName":null,"showInInteractNowBar":null,"type":"no-action","orderNumber":13,"paramString":null,"secondaryVideoURL":null,"adFormat":null,"toEmailLabel":null,"fromEmailLabel":null,"messageLabel":null,"phoneRecipientLabel":null,"fromNameLabel":null,"postInteractionLaunchURL":null,"brandAwarenessLevel":"2","facebookUrlType":null,"isActionButton":"1","iconDimension":"[16,174]","assetDimension":null,"origIconDimension":"[16,174]","origAssetDimension":null,"assetBgColor":null,"iconBgColor":null,"iconFileType":"image","isIconActivePanel":null,"iconParamString":null,"autoPlay":"1","iconGlowColor":null,"isIconBgTransparent":"0","isWatermarkLogo":null,"fallbackImgURL":null,"fallbackImgFileName":null,"shareUrlType":null,"shareMsg":null,"fallbackType":null,"fallbackWidgetSrc":null,"fallbackWidgetURL":null,"fallbackWidgetFileName":null,"isCreatedByWidget":null,"swfClickHandler":null,"iconCustomEventQueryStr":null,"actionCustomEventQueryStr":null}};
var widgetsJSON = {};
var nestedLayoutJSON = {"adIdx":"61854","layout":{"inbanner":{"14":{"640x480":{"isDefaultDimension":"0","isDefaultLayout":0,"scenes":{"scene-1":{"components":{"custom104":{"location":"542,190,19,18","options":[],"layerId":"2"},"custom105":{"location":"376,190,160,18","options":[],"layerId":"2"},"custom106":{"location":"192,103,123,69","options":{"initVisible":"1"},"layerId":"2"},"custom106.outputWindow":{"location":"326,11,302,170","options":{"outputWindowType":"custom","outputWindowCloseBtn":"1"},"layerId":"1"},"custom107":{"location":"192,22,123,69","options":{"initVisible":"1"},"layerId":"2"},"custom107.outputWindow":{"location":"325,11,302,170","options":{"outputWindowType":"custom","outputWindowCloseBtn":"1"},"layerId":"1"},"custom110":{"location":"0,441,186,33","options":[],"layerId":"2"},"custom111":{"location":"326,11,301,170","options":[],"layerId":"2"}}}}}}}}};
var primaryTrackersJSON = {};

var abTransitionJSON = {}; //store the action button properties that are enabled with transition effects here
var abTransitionJSONPopulated = false;
var transitionInEffectAB = {}; //action buttons that have transition "In" effects are stored here

var abTransitionSpeed = '';
var transitionTimersArray = new Array();
abTransitionSpeed = 'slow';

var thisBrowser = 'Chrome';
var defaultLayoutMatch = null;
var flashSupport = '1';
var campaignId = '47863';
var siteId = '2521715ca13bed';
var eventReportingURL = 'http://evs.jivox.com/jivox/serverAPIs/saveImpression.php';

//interactivity URL
var interactivityURL = "http://as.jivox.com/player/interactivity.php?expandAsInterstitial=1&t=1380317264318&r=0.4445457870606333&creativeUnitType=14&creativeUnitWidth=640&creativeUnitHeight=480&siteId=2521715ca13bed&campaignId=47863&clickTagURL=http%3A%2F%2Fadclick.g.doubleclick.net%2Faclk%3Fsa%3DL%26ai%3DB4Z7GUPhFUpLQE-vP0AG93ICIDaqowo0EAAAAEAEgwqCnDjgAWOqL5uphYMnGqYvApNgPsgEWd3d3LmNvc21vZW5lc3Bhbm9sLmNvbboBCzAwZ2ZwX2ltYWdlyAEJ2gEmaHR0cDovL3d3dy5jb3Ntb2VuZXNwYW5vbC5jb20vZmFzaGlvbi-pAo2ngfDMYXQ-wAIC4AIA6gI-LzcxODcvdGVsZXZpc2EuZWRpdG9yaWFsLmNvc21vZW5lc3Bhbm9sL2Nvc21vZW5lc3Bhbm9sLmZhc2hpb274AoHSHpAD4AOYA6QDqAMB0ASQTuAEAaAGIA%26num%3D0%26sig%3DAOD64_1auFdJJrgb5qh-EFPUxfZCfZCLWw%26client%3Dca-pub-7798366957477628%26adurl%3Dhttp%3A%2F%2Fwww.MiPantene.com&objectName=jvxAdPlayer_5245f850874f99_49863897&lDim=640x480&expandUnitType=&adUnitType=9&expandedUnit=1&viewLayout=&adUnitWidth=640&adUnitHeight=480&jvxSessionId=1380317264.9409&isExpandedUnit=true&inAppEmbeddedBrowser=";

//media gallery URL
var mediaGalleryURL = "/player/mediaGallery_v_version_.php?expandAsInterstitial=1&t=1380317264318&r=0.4445457870606333&creativeUnitType=14&creativeUnitWidth=640&creativeUnitHeight=480&siteId=2521715ca13bed&campaignId=47863&clickTagURL=http%3A%2F%2Fadclick.g.doubleclick.net%2Faclk%3Fsa%3DL%26ai%3DB4Z7GUPhFUpLQE-vP0AG93ICIDaqowo0EAAAAEAEgwqCnDjgAWOqL5uphYMnGqYvApNgPsgEWd3d3LmNvc21vZW5lc3Bhbm9sLmNvbboBCzAwZ2ZwX2ltYWdlyAEJ2gEmaHR0cDovL3d3dy5jb3Ntb2VuZXNwYW5vbC5jb20vZmFzaGlvbi-pAo2ngfDMYXQ-wAIC4AIA6gI-LzcxODcvdGVsZXZpc2EuZWRpdG9yaWFsLmNvc21vZW5lc3Bhbm9sL2Nvc21vZW5lc3Bhbm9sLmZhc2hpb274AoHSHpAD4AOYA6QDqAMB0ASQTuAEAaAGIA%26num%3D0%26sig%3DAOD64_1auFdJJrgb5qh-EFPUxfZCfZCLWw%26client%3Dca-pub-7798366957477628%26adurl%3Dhttp%3A%2F%2Fwww.MiPantene.com&objectName=jvxAdPlayer_5245f850874f99_49863897&lDim=640x480&expandUnitType=&adUnitType=9&expandedUnit=1&viewLayout=&adUnitWidth=640&adUnitHeight=480&jvxSessionId=1380317264.9409";

//companion URL 
var companionBannerURL = 'http://as.jivox.com/player/customInteraction.php?id=47863&expandAsInterstitial=1&t=1380317264318&r=0.4445457870606333&creativeUnitType=14&creativeUnitWidth=640&creativeUnitHeight=480&siteId=2521715ca13bed&campaignId=47863&clickTagURL=http%3A%2F%2Fadclick.g.doubleclick.net%2Faclk%3Fsa%3DL%26ai%3DB4Z7GUPhFUpLQE-vP0AG93ICIDaqowo0EAAAAEAEgwqCnDjgAWOqL5uphYMnGqYvApNgPsgEWd3d3LmNvc21vZW5lc3Bhbm9sLmNvbboBCzAwZ2ZwX2ltYWdlyAEJ2gEmaHR0cDovL3d3dy5jb3Ntb2VuZXNwYW5vbC5jb20vZmFzaGlvbi-pAo2ngfDMYXQ-wAIC4AIA6gI-LzcxODcvdGVsZXZpc2EuZWRpdG9yaWFsLmNvc21vZW5lc3Bhbm9sL2Nvc21vZW5lc3Bhbm9sLmZhc2hpb274AoHSHpAD4AOYA6QDqAMB0ASQTuAEAaAGIA%26num%3D0%26sig%3DAOD64_1auFdJJrgb5qh-EFPUxfZCfZCLWw%26client%3Dca-pub-7798366957477628%26adurl%3Dhttp%3A%2F%2Fwww.MiPantene.com&objectName=jvxAdPlayer_5245f850874f99_49863897&lDim=640x480&expandUnitType=&adUnitType=9&expandedUnit=1&viewLayout=&adUnitWidth=640&adUnitHeight=480&jvxSessionId=1380317264.9409&key=companionBanner&assetBgColor=&clickTagURL=http%3A%2F%2Fadclick.g.doubleclick.net%2Faclk%3Fsa%3DL%26ai%3DB4Z7GUPhFUpLQE-vP0AG93ICIDaqowo0EAAAAEAEgwqCnDjgAWOqL5uphYMnGqYvApNgPsgEWd3d3LmNvc21vZW5lc3Bhbm9sLmNvbboBCzAwZ2ZwX2ltYWdlyAEJ2gEmaHR0cDovL3d3dy5jb3Ntb2VuZXNwYW5vbC5jb20vZmFzaGlvbi-pAo2ngfDMYXQ-wAIC4AIA6gI-LzcxODcvdGVsZXZpc2EuZWRpdG9yaWFsLmNvc21vZW5lc3Bhbm9sL2Nvc21vZW5lc3Bhbm9sLmZhc2hpb274AoHSHpAD4AOYA6QDqAMB0ASQTuAEAaAGIA%26num%3D0%26sig%3DAOD64_1auFdJJrgb5qh-EFPUxfZCfZCLWw%26client%3Dca-pub-7798366957477628%26adurl%3Dhttp%3A%2F%2Fwww.MiPantene.com';

function serialize(obj) {
	var str = [];
	for(var p in obj){
		str.push(encodeURIComponent(p) + "=" + encodeURIComponent(obj[p]));
	}
	return str.join("&");
}

function fireExternalTracker(url){
	var imgEl = document.createElement('img');
	var finalURL = "";

	if(!url.match("http://evs.jivox.com/jivox/serverAPIs/saveImpression.php")){
		var replaceCacheBuster0 = url.replace('[timestamp]', Math.random()); 
var replaceCacheBuster1 = replaceCacheBuster0.replace('[randomNumber]', Math.random()); 
var replaceCacheBuster2 = replaceCacheBuster1.replace('{cacheBuster}', Math.random()); 
var replaceCacheBuster3 = replaceCacheBuster2.replace('{RANDOMNUM}', Math.random()); 
var replaceCacheBuster4 = replaceCacheBuster3.replace('%%CACHEBUSTER%%', Math.random()); 
finalURL = replaceCacheBuster4;    	//finalURL = replaceCacheBuster;
	}else{
		if(url.indexOf("?") == -1){
            finalURL = url + "?r=" + Math.random();
        }else{
        	finalURL = url + "&r=" + Math.random();
        }
	}
    
    imgEl.src = finalURL;
}        

/* LAYOUTER JS */
//layouter constructor
function layouter(){
   this.isIPanelOverlay = 0;
}

layouter.prototype.getClosest = function(width, height, globalLayouts){

	closest = null;
	str = "";
	excludeAddressBarHeight = 100;
	var layoutMatchRange = parseInt(1000);
	var closestMatch = null;
	var prevAssetHeight = 0;
	var layoutCount = 0;
	var tmpLayout = null;

	for(var layoutItem in globalLayouts){
		tmpLayout = layoutItem;
		layoutCount++;
	}

	if(layoutCount == 1){ // if there is only one layout, return that. don't do the layout match etc.,
		return tmpLayout;
	}

	for(var layoutItem in globalLayouts){
		cords = layoutItem.split('x');
		assetWidth = parseInt(cords[0]);
		assetHeight = parseInt(cords[1]);
		
		if(assetWidth == width && assetHeight == height){
			 
			return layoutItem;
		}

		if(((assetWidth == width) && (Math.abs(assetHeight - height)) <= excludeAddressBarHeight)){
			if(prevAssetHeight != 0 && (Math.abs(prevAssetHeight-height) < Math.abs(assetHeight-height))){
				continue;
			}
			closestMatch = layoutItem;
			prevAssetHeight = assetHeight;			
		}
	}

	if(closestMatch != null){
		 
		return closestMatch;
	}
	
	for(var layoutItem in globalLayouts){
		cords = layoutItem.split('x');
		assetWidth = parseInt(cords[0]);
		assetHeight = parseInt(cords[1]);

		var currentWidthDiff = Math.abs(assetWidth - width);
		var currentHeightDiff = Math.abs(assetHeight - height);
		if(currentWidthDiff <= layoutMatchRange && currentHeightDiff <= layoutMatchRange){
			layoutMatchRange = (currentWidthDiff > currentHeightDiff) ? currentWidthDiff : currentHeightDiff;
			closestMatch = layoutItem;
			 
		}
	}
	
	if(closestMatch != null){
		return closestMatch;
	}

	var closestLayoutItem = null;
	var vpOrientation = this.getOrientation(document.documentElement.clientWidth,document.documentElement.clientHeight); //viewport orientation
	for(var i in defaultLayoutMatch){
		var layoutItem = defaultLayoutMatch[i];
		var layoutItemCords = layoutItem.split("x");
		var layoutItemWidth = layoutItemCords[0];		
		var layoutItemHeight = layoutItemCords[1];
		var layoutOrientation = this.getOrientation(layoutItemWidth,layoutItemHeight);
		if(vpOrientation != layoutOrientation){ 
			continue;//select the closest layout by considering the orienation mode as well
		}
		if(closest == null || Math.abs(width - closest) > Math.abs(layoutItemWidth - width))
	    {
	      closest = layoutItemWidth;
		  closestLayoutItem = layoutItem;
	    }
	}
	return (closestLayoutItem != null) ? closestLayoutItem : null;
}

//var isPlayerPaused = false;
layouter.prototype.renderLayoutContainerAndPlayer = function(){	
	var layoutScenes = this.layoutData['scenes'];
	var sceneId = this.activeSceneId;
		
	//for(var sceneId in layoutScenes){
		var scene = layoutScenes[sceneId]['components'];
		var closeSceneDiv = false;
		isPlayerInLayoutScene = scene['player'] == undefined ? false : true;
		if($('#' + sceneId).length == 0){
						document.write('<div id='+sceneId+'>');
			closeSceneDiv = true;
					}else{
				
					}		

		if(scene['player'] != undefined && scene['player']['options'] != undefined){
			this.isIPanelOverlay = scene['player']['options']['isIPanelOverlay'];
			var overlayIntrParam = (this.isIPanelOverlay == 1) ? '' : 'enableInteractivity=false';
			interactivityURL = interactivityURL + "&" + overlayIntrParam;
		}else{
			interactivityURL = interactivityURL + "&enableInteractivity=false";
		}


		if(scene['player'] != undefined){ // Do the player render first before rendering any other components

			videoElementsInScene['player'] = {'autoPlay':''}; 

			var playerLocationAndDimArr = scene['player']['location'].split(',');
			var orgZIndex = scene['player']['layerId'];

			playerWidth = playerLocationAndDimArr[2];
			playerHeight = playerLocationAndDimArr[3];

						
			if($('#player').length == 0){
				
									var jvxRandomNumber = Math.random();
					var jvxTimeStamp = new Date();
					var jvxJsHost = "http://";
					
					document.write(unescape("%3Cscript src='http://as.jivox.com/player/jivox_ad_tags.php?t="+ jvxTimeStamp.getTime() + "&r=" + jvxRandomNumber + "&reportingURL%3Dhttp%253A%252F%252Fevs.jivox.com%26expandAsInterstitial%3D1%26t%3D1380317264318%26r%3D0.4445457870606333%26creativeUnitType%3D14%26creativeUnitWidth%3D640%26creativeUnitHeight%3D480%26siteId%3D2521715ca13bed%26campaignId%3D47863%26clickTagURL%3Dhttp%253A%252F%252Fadclick.g.doubleclick.net%252Faclk%253Fsa%253DL%2526ai%253DB4Z7GUPhFUpLQE-vP0AG93ICIDaqowo0EAAAAEAEgwqCnDjgAWOqL5uphYMnGqYvApNgPsgEWd3d3LmNvc21vZW5lc3Bhbm9sLmNvbboBCzAwZ2ZwX2ltYWdlyAEJ2gEmaHR0cDovL3d3dy5jb3Ntb2VuZXNwYW5vbC5jb20vZmFzaGlvbi-pAo2ngfDMYXQ-wAIC4AIA6gI-LzcxODcvdGVsZXZpc2EuZWRpdG9yaWFsLmNvc21vZW5lc3Bhbm9sL2Nvc21vZW5lc3Bhbm9sLmZhc2hpb274AoHSHpAD4AOYA6QDqAMB0ASQTuAEAaAGIA%2526num%253D0%2526sig%253DAOD64_1auFdJJrgb5qh-EFPUxfZCfZCLWw%2526client%253Dca-pub-7798366957477628%2526adurl%253Dhttp%253A%252F%252Fwww.MiPantene.com%26objectName%3DjvxAdPlayer_5245f850874f99_49863897%26lDim%3D640x480%26expandUnitType%3D%26adUnitType%3D9%26expandedUnit%3D1%26viewLayout%3D%26adUnitWidth%3D640%26adUnitHeight%3D480%26jvxSessionId%3D1380317264.9409%260%3D%26serverURL%3Dhttp%253A%252F%252Fas.jivox.com%26expandedUnitPlayerVolume%3D1%26expandedMode%3Doverlay%26switchToDetailOn%3DmouseOverButton%26switchToOverlayOn%3DmouseOverButton%26expandedUnitzIndex%3D999999%26maskZIndex%3D50%26width%3D300%26height%3D250%26iframeTag%3Don%26inAppEmbeddedBrowser%3D%26jivoxBranded%3Dfalse%26autoPlay%3Dtrue&"+overlayIntrParam+"&width="+playerWidth+"&height="+playerHeight+"&recordUIR=0&expandUnitType=&addPlayerContainerWithId=player&orgPlayerZIndex="+orgZIndex+"' type='text/javascript'%3E%3C/script%3E"));
				
				var checkPlayerInterval = setInterval(function(){
					if($('#player').length > 0){	
						$('#player').addClass('components shadow');
						$('<div class="closeSecondaryVideo"></div>').appendTo('#player');
						$('<iframe id="secondaryVideo" src="blank.html" width="'+playerWidth+'" height="'+playerHeight+'" frameborder="0" scrolling="no" style="position:absolute; display: none; z-index:10; background:#000;top:0px;left:0px;"></iframe>').appendTo('#player');
						clearInterval(checkPlayerInterval);
					}
				},500);

			}else{
												//$('#player').show();
			}
		}
				if(closeSceneDiv){ //close the scene div only when it is not closed
			document.write('</div>');
		}
			//}

		for(var sceneId in layoutScenes){
			if($('#' + sceneId).length == 0){
				$('<div id='+sceneId+' data-role="page"></div>').appendTo(document.body);
			}
		}
}
var elementsRendered  = false;
// method that renders all components except player since that is rendered in renderLayoutContainerAndPlayer
layouter.prototype.renderLayoutComponents = function(){
	elementsRendered  = false;
	var layoutScenes = this.layoutData['scenes'];
	var that = this;
	this.outputWinJSON = {};
	var sceneId = this.activeSceneId;
	isInPlaceVideoInScene = false;
	transitionInEffectAB = {};
	//for(var sceneId in layoutScenes){
		var scene = layoutScenes[sceneId]['components'];

		for(var component in scene){
			if(component == 'player'){
				// player rendering is done in renderLayoutContainerAndPlayer method.
				continue;
			}
			else if(component == 'interactivity_panel' && this.isIPanelOverlay != 1){
				/* 
				for components(intr panel, companion) that are loaded in iframe use a container because during orientation change we try to hide the components first and that does not work for iframes in iOS devices.
				*/
				if($('#' + component).length == 0){
					$('<div id="'+component+'_container" class="components"></div>').appendTo('#'+ sceneId).show();
					$('<iframe id="'+component+'" class="shadow" src="'+interactivityURL+'" frameborder="0" allowtransparency="true" scrolling="no" style="background:transparent;"></iframe>').appendTo('#'+component+'_container').show();
				}else{
					$('#'+component+'_container').show();
				}
			}
			else if(component == 'twitter_panel'){
				var twitterLocationAndDimArr = scene[component]['location'].split(',');
				var twitterWidth = twitterLocationAndDimArr[2];
				var twitterHeight = twitterLocationAndDimArr[3];
				var twitterBg = '';
												twitterBg = (twitterWidth == 340) ? 'background:url(http://as.jivox.com/advertiser/images/TwitterBG.png) no-repeat -65px 0px' : 'background:url(http://as.jivox.com/advertiser/images/TwitterBGSmall.png) no-repeat -50px 0px';
								
				if($('#' + component).length == 0){
					$.getScript("http://as.jivox.com/advertiser/js/jquery.tweet.jivox.js").done(function(script, textStatus) {

						        $(".rrt").relatedTweets({
									debug : 1
                                    ,extraParam:'campaignId_47863'
                                    ,serverName:''
																		,query:''
																		,status:1
									,realtime:0
									,n:20
									,show_avatar:0
									,show_author:0
								});
						
					});
					$('<div class="rrt components" id="'+component+'" style="overflow:hidden; position:absolute; width:'+twitterWidth+'px; height:'+twitterHeight+'px;'+twitterBg+'"><p class="loading">Loading tweets...</p></div>').appendTo('#' + sceneId).show();
				}else{
					$('#' + component).show();
				}
			}
			else if(component == 'companion_banner'){
				/* 
				for components(intr panel, companion) that are loaded in iframe use a container because during orientation change we try to hide the components first and that does not work for iframes in iOS devices.
				*/
				if($('#' + component).length == 0){
					$('<div id="'+component+'_container" class="components"></div>').appendTo('#'+ sceneId).show();
					$('<iframe id="'+component+'" class="shadow"  src="'+companionBannerURL+'" frameborder="0" allowtransparency="true" scrolling="no" style="background:transparent;"></iframe>').appendTo('#'+component+'_container').show();
										//record impression for clickThroughUrl interaction.
					fireExternalTracker("http://evs.jivox.com/jivox/serverAPIs/saveImpression.php?" + serialize({"campaignId":"47863", "siteId" : "2521715ca13bed", "clickThrough":"7", "jvxSessionId" : "1380317264.9409", "elapsedTime": "0", "adUnitType" : "9", "es_pId" : ""}));
														}else{
					$('#'+component+'_container').show();
				}
			}
			else if(component.indexOf('gallery') != -1){ //gallery or output windows
				if(component.indexOf('outputWindow') != -1){//output windows
					this.outputWinJSON[component] = scene[component];
				}else{//gallery
					var galleryBtnOptions = scene[component]['options'];
					if($('#' + component).length == 0){
						$('<div id="'+component+'_container" class="components"></div>').appendTo('#'+ sceneId).show();
						
						if(parseInt(widgetsJSON["customWidget."+component].options.shadow) == 1){
							
							if($('#galleryShadowStyleContainer').length == 0){
									$("<style type='text/css' id='galleryShadowStyleContainer'></style>").appendTo("head");
							}
							var shadowColor = widgetsJSON["customWidget."+component].options.shadowColor;
							var shadowClass = '#'+component+'_container iframe{box-shadow: 4px 4px 2px '+shadowColor+';-moz-box-shadow: 4px 4px 2px '+shadowColor+';-webkit-box-shadow: 4px 4px 2px '+shadowColor+';-ms-filter: "progid:DXImageTransform.Microsoft.Glow(Strength=3,Color='+shadowColor+')";filter: progid:DXImageTransform.Microsoft.Glow(Strength=3, Color='+shadowColor+');}';
							try{
								$('#galleryShadowStyleContainer').append(shadowClass);	
							}catch(e){// handle IE7/8. Fix for http://mycroft.jivox.com:8080/browse/ADPTL-4570
								shadowClass = document.getElementById('galleryShadowStyleContainer').styleSheet.cssText + shadowClass;
								document.getElementById('galleryShadowStyleContainer').styleSheet.cssText = shadowClass;									
							}
						}
						var mediaGallerySrc =  mediaGalleryURL.replace("_version_", (isNaN(parseInt(widgetsJSON["customWidget."+component].version)) ? "1" : widgetsJSON["customWidget."+component].version));
						mediaGallerySrc += "&component="+component;
						mediaGallerySrc += "&scrollByThumbnails=true";
						mediaGallerySrc += "&isMobile=0";
												mediaGallerySrc += "&inAppEmbeddedBrowser=0";
						mediaGallerySrc += "&playerEventURL=/jivox/serverAPIs/saveImpression.php";
						mediaGallerySrc += "&adUnitType=9";
												
						$('<iframe id="'+component+'" src="'+mediaGallerySrc+'" frameborder="0" allowtransparency="true" scrolling="no" style="background:transparent;"></iframe>').appendTo('#'+component+'_container').show();
					}else{
						$('#'+component+'_container').show();
					}
					populateABTransitionJSON(component,galleryBtnOptions);
					populateShowHideAfterJSON(component,galleryBtnOptions);
				}
			}
			else if(component.indexOf('custom') != -1){ //action buttons or output windows
				if(component.indexOf('outputWindow') != -1){//output windows
					this.outputWinJSON[component] = scene[component];
				}else{//action buttons
					var actionBtnCompleteId = this.getCompleteActionButtonId(component);
					var actionBtnLayoutInfo = scene[component]['location'];
					var actionBtnOptions = scene[component]['options'];
					var actionBtnLayoutInfoArr = actionBtnLayoutInfo.split(',');
					var actionBtnDetails = actionButtonsJSON[actionBtnCompleteId];
					var actionBtnIconURL = actionBtnDetails['icon'];
					var actionBtnFlashParams = {'wmode' : 'transparent'  };
					var actionBtnIconParamString = actionBtnDetails['iconParamString'];
					var actionBtnIconFileType = actionBtnDetails['iconFileType'];
					var clickActionType = actionBtnDetails['type'];
					var actionBtnEventType = actionBtnDetails['eventType'];
					var externalStartEventId = actionBtnEventType * 100;// give the start event id to SWF creators
					var flashVarForTracking = {'campaignId':campaignId,'siteId':siteId,'eventReportingURL':eventReportingURL,'eventId':externalStartEventId,'clickTag':'http%3A%2F%2Fevs.jivox.com%2Fjivox%2FserverAPIs%2FexternalReporting%2Fproxy.php%3FcampaignId%3D47863%26siteId%3D2521715ca13bed%26adUnitType%3D9%26es_pId%3D%26jvxSessionId%3D1380317264.9409%26clickTagURL%3Dhttp%253A%252F%252Fadclick.g.doubleclick.net%252Faclk%253Fsa%253DL%2526ai%253DB4Z7GUPhFUpLQE-vP0AG93ICIDaqowo0EAAAAEAEgwqCnDjgAWOqL5uphYMnGqYvApNgPsgEWd3d3LmNvc21vZW5lc3Bhbm9sLmNvbboBCzAwZ2ZwX2ltYWdlyAEJ2gEmaHR0cDovL3d3dy5jb3Ntb2VuZXNwYW5vbC5jb20vZmFzaGlvbi-pAo2ngfDMYXQ-wAIC4AIA6gI-LzcxODcvdGVsZXZpc2EuZWRpdG9yaWFsLmNvc21vZW5lc3Bhbm9sL2Nvc21vZW5lc3Bhbm9sLmZhc2hpb274AoHSHpAD4AOYA6QDqAMB0ASQTuAEAaAGIA%2526num%253D0%2526sig%253DAOD64_1auFdJJrgb5qh-EFPUxfZCfZCLWw%2526client%253Dca-pub-7798366957477628%2526adurl%253Dhttp%253A%252F%252Fwww.MiPantene.com','actionButtonId':actionBtnCompleteId, 'jvxSessionId':'1380317264.9409','adUnitType':'9'  , "es_pId" : ""};	

					var apiVars = '';
										apiVars = '?campaignId=47863&siteId=2521715ca13bed&adUnitType=9&jvxSessionId=1380317264.9409&clickTagURL=http%3A%2F%2Fevs.jivox.com%2Fjivox%2FserverAPIs%2FexternalReporting%2Fproxy.php%3FcampaignId%3D47863%26siteId%3D2521715ca13bed%26adUnitType%3D9%26es_pId%3D%26jvxSessionId%3D1380317264.9409%26clickTagURL%3Dhttp%253A%252F%252Fadclick.g.doubleclick.net%252Faclk%253Fsa%253DL%2526ai%253DB4Z7GUPhFUpLQE-vP0AG93ICIDaqowo0EAAAAEAEgwqCnDjgAWOqL5uphYMnGqYvApNgPsgEWd3d3LmNvc21vZW5lc3Bhbm9sLmNvbboBCzAwZ2ZwX2ltYWdlyAEJ2gEmaHR0cDovL3d3dy5jb3Ntb2VuZXNwYW5vbC5jb20vZmFzaGlvbi-pAo2ngfDMYXQ-wAIC4AIA6gI-LzcxODcvdGVsZXZpc2EuZWRpdG9yaWFsLmNvc21vZW5lc3Bhbm9sL2Nvc21vZW5lc3Bhbm9sLmZhc2hpb274AoHSHpAD4AOYA6QDqAMB0ASQTuAEAaAGIA%2526num%253D0%2526sig%253DAOD64_1auFdJJrgb5qh-EFPUxfZCfZCLWw%2526client%253Dca-pub-7798366957477628%2526adurl%253Dhttp%253A%252F%252Fwww.MiPantene.com&eventReportingURL=http://evs.jivox.com/jivox/serverAPIs/saveImpression.php&externalStartEventId=' + externalStartEventId;
					
					var flashAttributes = {"class":""};
					var actionBtnIconBgColor = actionBtnDetails['iconBgColor'];
					var isActionBtnBgTransparent = Number(actionBtnDetails['isIconBgTransparent']);
					var actionBtnIconGlowColor =  actionBtnDetails['iconGlowColor'];
					var isWatermarkLogo = actionBtnDetails['isWatermarkLogo'];
					var actionBtnWidth = actionBtnLayoutInfoArr[2];
					var actionBtnHeight = actionBtnLayoutInfoArr[3];
					var actionBtnAssetDim = actionBtnDetails['assetDimension'];
					var actionBtnFallbackType = actionBtnDetails['fallbackType'];
					var actionBtnFallbackWidgetSrc = actionBtnDetails['fallbackWidgetSrc'];
					var actionBtnFallbackWidgetURL = actionBtnDetails['fallbackWidgetURL'];
					var actionBtnFallbackImage = actionBtnDetails['fallbackImgURL'];
					if($.trim(actionBtnIconParamString) != '' && actionBtnIconFileType == 'swf'){

						if(actionBtnIconParamString != "" && actionBtnIconParamString.indexOf('BOOL_') > -1)actionBtnIconParamString = actionBtnIconParamString.replace(/BOOL\_/g,"");
						
						var swfWidgetParams = "&serverURL=http://as.jivox.com";
													swfWidgetParams += "&campaignId=47863&siteId=2521715ca13bed";
												swfWidgetParams += "&jvxSessionId=1380317264.9409";
						actionBtnIconURL = actionBtnIconURL + "?" + actionBtnIconParamString + swfWidgetParams;
					}					
					
					if(flashSupport && !isActionBtnBgTransparent){						
						if(actionBtnIconBgColor != ''){			
							//delete actionBtnFlashParams['wmode'];
							actionBtnFlashParams['bgcolor'] = actionBtnIconBgColor;
							$('#' + component).css('background-color','#'+actionBtnIconBgColor);
						}
					}

					if(actionBtnIconFileType == 'swf'){
						if(!flashSupport && (!actionBtnFallbackWidgetSrc && !actionBtnFallbackWidgetURL && !actionBtnFallbackImage)){ 
							// do not render SWF components when there is no flash support and no fall back
							continue;
						}
					}

					if(window.location.protocol.indexOf('https://') != -1){
						actionBtnIconURL = actionBtnIconURL.replace('http://','https://');
						flashAttributes['classid'] = "clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"; 
						flashAttributes['codebase'] = "https://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0";
					}

					var useHTML5 = false
					if($('#' + component).length == 0){
						if(actionBtnIconFileType == 'custom-widget'){							
							$('<iframe src="http://as.jivox.com/player/customInteraction.php?id=47863&expandAsInterstitial=1&t=1380317264318&r=0.4445457870606333&creativeUnitType=14&creativeUnitWidth=640&creativeUnitHeight=480&siteId=2521715ca13bed&campaignId=47863&clickTagURL=http%3A%2F%2Fadclick.g.doubleclick.net%2Faclk%3Fsa%3DL%26ai%3DB4Z7GUPhFUpLQE-vP0AG93ICIDaqowo0EAAAAEAEgwqCnDjgAWOqL5uphYMnGqYvApNgPsgEWd3d3LmNvc21vZW5lc3Bhbm9sLmNvbboBCzAwZ2ZwX2ltYWdlyAEJ2gEmaHR0cDovL3d3dy5jb3Ntb2VuZXNwYW5vbC5jb20vZmFzaGlvbi-pAo2ngfDMYXQ-wAIC4AIA6gI-LzcxODcvdGVsZXZpc2EuZWRpdG9yaWFsLmNvc21vZW5lc3Bhbm9sL2Nvc21vZW5lc3Bhbm9sLmZhc2hpb274AoHSHpAD4AOYA6QDqAMB0ASQTuAEAaAGIA%26num%3D0%26sig%3DAOD64_1auFdJJrgb5qh-EFPUxfZCfZCLWw%26client%3Dca-pub-7798366957477628%26adurl%3Dhttp%3A%2F%2Fwww.MiPantene.com&objectName=jvxAdPlayer_5245f850874f99_49863897&lDim=640x480&expandUnitType=&adUnitType=9&expandedUnit=1&viewLayout=&adUnitWidth=640&adUnitHeight=480&jvxSessionId=1380317264.9409&actionButton=1&key='+actionBtnCompleteId+'" id="'+component+'" class="components" frameborder="0" scrolling="no" allowtransparency="true"></iframe>').appendTo('#' + sceneId).show();
						} else if(actionBtnIconFileType == 'swf' || clickActionType == 'inline-video'){
							if(actionBtnIconFileType == 'swf' && !flashplugin){
								// if action button is a SWF and no flash support on the browser, render fallback.
								
								if(actionBtnFallbackType == 'widget-src'){
									$('<iframe src="http://as.jivox.com/player/customInteraction.php?id=47863&expandAsInterstitial=1&t=1380317264318&r=0.4445457870606333&creativeUnitType=14&creativeUnitWidth=640&creativeUnitHeight=480&siteId=2521715ca13bed&campaignId=47863&clickTagURL=http%3A%2F%2Fadclick.g.doubleclick.net%2Faclk%3Fsa%3DL%26ai%3DB4Z7GUPhFUpLQE-vP0AG93ICIDaqowo0EAAAAEAEgwqCnDjgAWOqL5uphYMnGqYvApNgPsgEWd3d3LmNvc21vZW5lc3Bhbm9sLmNvbboBCzAwZ2ZwX2ltYWdlyAEJ2gEmaHR0cDovL3d3dy5jb3Ntb2VuZXNwYW5vbC5jb20vZmFzaGlvbi-pAo2ngfDMYXQ-wAIC4AIA6gI-LzcxODcvdGVsZXZpc2EuZWRpdG9yaWFsLmNvc21vZW5lc3Bhbm9sL2Nvc21vZW5lc3Bhbm9sLmZhc2hpb274AoHSHpAD4AOYA6QDqAMB0ASQTuAEAaAGIA%26num%3D0%26sig%3DAOD64_1auFdJJrgb5qh-EFPUxfZCfZCLWw%26client%3Dca-pub-7798366957477628%26adurl%3Dhttp%3A%2F%2Fwww.MiPantene.com&objectName=jvxAdPlayer_5245f850874f99_49863897&lDim=640x480&expandUnitType=&adUnitType=9&expandedUnit=1&viewLayout=&adUnitWidth=640&adUnitHeight=480&jvxSessionId=1380317264.9409&key='+actionBtnCompleteId+'&flashplugin=0&actionButton=1" id="'+component+'" class="components" frameborder="0" scrolling="no" allowtransparency="true"></iframe>').appendTo('#' + sceneId).show();
									continue;
								}else if(actionBtnFallbackType == 'widget-url' || actionBtnFallbackType == 'swiffy'){
									$('<iframe src="'+actionBtnFallbackWidgetURL + apiVars + '" id="'+component+'" class="components" frameborder="0" scrolling="no" allowtransparency="true"></iframe>').appendTo('#' + sceneId).show();
									continue;
								}								
							}

							var altImage = (actionBtnIconFileType == 'swf') ? actionBtnFallbackImage : actionBtnIconURL;
							var altImageTag = '<a href="http://evs.jivox.com/jivox/serverAPIs/externalReporting/proxy.php?campaignId=47863&siteId=2521715ca13bed&adUnitType=9&es_pId=&jvxSessionId=1380317264.9409&clickTagURL=http%3A%2F%2Fadclick.g.doubleclick.net%2Faclk%3Fsa%3DL%26ai%3DB4Z7GUPhFUpLQE-vP0AG93ICIDaqowo0EAAAAEAEgwqCnDjgAWOqL5uphYMnGqYvApNgPsgEWd3d3LmNvc21vZW5lc3Bhbm9sLmNvbboBCzAwZ2ZwX2ltYWdlyAEJ2gEmaHR0cDovL3d3dy5jb3Ntb2VuZXNwYW5vbC5jb20vZmFzaGlvbi-pAo2ngfDMYXQ-wAIC4AIA6gI-LzcxODcvdGVsZXZpc2EuZWRpdG9yaWFsLmNvc21vZW5lc3Bhbm9sL2Nvc21vZW5lc3Bhbm9sLmZhc2hpb274AoHSHpAD4AOYA6QDqAMB0ASQTuAEAaAGIA%26num%3D0%26sig%3DAOD64_1auFdJJrgb5qh-EFPUxfZCfZCLWw%26client%3Dca-pub-7798366957477628%26adurl%3Dhttp%3A%2F%2Fwww.MiPantene.com" border="0" target="_blank"><img src="'+altImage+'" border="0" style="width:'+actionBtnWidth+'px; height:'+actionBtnHeight+'px;" /></a>';
							altImageTag = ($.trim(altImage) == "") ? "" : altImageTag;

							var componentPlaceHolder = component + 'PlaceHolder';

							if((!useHTML5 && clickActionType == 'inline-video') || actionBtnIconFileType == 'swf'){
								$('<div id='+component+' class="components"><div id='+componentPlaceHolder+'>'+altImageTag+'</div></div>').appendTo('#' + sceneId).show();
							}
							
							if(clickActionType == 'inline-video'){
								isInPlaceVideoInScene = true;
								//$('#' + inPlaceVideoId).remove(); // remove if any in-place video exists that is created through different action button
								//inPlaceVideoId = component;
								var videoURL = actionBtnDetails['data'];
								actionBtnAssetDim = eval(actionBtnAssetDim);
								var videoWidth = actionBtnAssetDim[0];
								var videoHeight = actionBtnAssetDim[1];
								var thumbnailURL = actionBtnIconURL;
                                var paramString = actionBtnDetails['paramString'];
								inplaceVideoAutoPlay = (actionBtnDetails['autoPlay'] == 1) ? true : false;
								if(sceneId != "scene-1"){
									inplaceVideoAutoPlay = false;
								}
								videoElementsInScene[component] = {'autoPlay':inplaceVideoAutoPlay}; 
                                var clickparams = ""; 
                                                                                                                                        clickThroughURL = 'http%3A%2F%2Fadclick.g.doubleclick.net%2Faclk%3Fsa%3DL%26ai%3DB4Z7GUPhFUpLQE-vP0AG93ICIDaqowo0EAAAAEAEgwqCnDjgAWOqL5uphYMnGqYvApNgPsgEWd3d3LmNvc21vZW5lc3Bhbm9sLmNvbboBCzAwZ2ZwX2ltYWdlyAEJ2gEmaHR0cDovL3d3dy5jb3Ntb2VuZXNwYW5vbC5jb20vZmFzaGlvbi-pAo2ngfDMYXQ-wAIC4AIA6gI-LzcxODcvdGVsZXZpc2EuZWRpdG9yaWFsLmNvc21vZW5lc3Bhbm9sL2Nvc21vZW5lc3Bhbm9sLmZhc2hpb274AoHSHpAD4AOYA6QDqAMB0ASQTuAEAaAGIA%26num%3D0%26sig%3DAOD64_1auFdJJrgb5qh-EFPUxfZCfZCLWw%26client%3Dca-pub-7798366957477628%26adurl%3Dhttp%3A%2F%2Fwww.MiPantene.com'; 
                                        clickparams += "&clickThroughURL="+clickThroughURL;
                                
																var inplaceVideoURL = "http://as.jivox.com/player/InteractivityPlayer.swf?inplace=1&adUnitType=9&reportingURL=http://evs.jivox.com&campaignId=47863&siteId=2521715ca13bed&expandedUnitPlayerVolume=1&expandedUnit=1&expandUnitType=&videoFile="+ videoURL+"&thumbnailURL="+thumbnailURL+"&videoWidth="+videoWidth+"&videoHeight="+videoHeight+"&autoPlay=" + inplaceVideoAutoPlay + "&eventId="+actionBtnEventType+"&actionButtonId="+actionBtnCompleteId+"&es_pId="+"&jvxSessionId=1380317264.9409"+"&closeWhenDone="+layout.isCloseOnDone(component)+"&"+paramString+clickparams;
								swfobject.embedSWF(inplaceVideoURL, componentPlaceHolder, actionBtnWidth, actionBtnHeight, "9.0.280", false, {}, {'wmode':'transparent'});
															}else{
																swfobject.embedSWF(actionBtnIconURL, componentPlaceHolder, actionBtnWidth, actionBtnHeight, "9.0.280", false, flashVarForTracking, actionBtnFlashParams, flashAttributes);
															}
							
							if(actionBtnIconFileType == 'swf' && actionBtnDetails['swfClickHandler'] == 'system' && clickActionType != "no-action" && clickActionType != "trigger"){ // SWF clicks handled by the system if its configured to do so.
								$('#' + component).css({'cursor':'pointer'}).bind({
								"mousedown" : function(){
									that.launchOutputWin(this.id);
									that.invokeSecondaryAction(this.id);
									abMsg(this.id + ".clicked");
								}
								});
							}else if(actionBtnIconFileType == 'swf' && clickActionType == "trigger" && actionBtnDetails['swfClickHandler'] == "system") {
								if(actionBtnOptions.hasOwnProperty('invokeOn') && actionBtnOptions['invokeOn'] == '1') {
									$('#' + component).css({'cursor':'pointer'}).bind({
										"mouseover" : function(){
											that.invokeSecondaryAction(this.id);
											that.fireABEvent(this.id);
											abMsg(this.id + ".hovered");
										}
									});
								} else {
									$('#' + component).css({'cursor':'pointer'}).bind({
										"mousedown" : function(){
											that.invokeSecondaryAction(this.id);
											that.fireABEvent(this.id);
											abMsg(this.id + ".clicked");
										}
									});
								}
							}

						} else {
							var glowClass = '';
							if(clickActionType != 'no-action' && actionBtnIconGlowColor != undefined && actionBtnIconGlowColor != ''){								
								if($('#glowStyleContainer').length == 0){
									$("<style type='text/css' id='glowStyleContainer'></style>").appendTo("head");
								}
								glowClass = '.shadowGlow'+component+'{' + (isMSIE ? 'border: 1px Solid '+actionBtnIconGlowColor+'; ' : '') + 'box-shadow: 0 0 3px 3px '+actionBtnIconGlowColor+';-moz-box-shadow: 0 0 3px 3px '+actionBtnIconGlowColor+';-webkit-box-shadow: 0 0 3px 3px '+actionBtnIconGlowColor+';-ms-filter: "progid:DXImageTransform.Microsoft.Glow(Strength=3,Color='+actionBtnIconGlowColor+')";filter: progid:DXImageTransform.Microsoft.Glow(Strength=3, Color='+actionBtnIconGlowColor+');}';
								try{
									$('#glowStyleContainer').append(glowClass);	
								}catch(e){// handle IE7/8. Fix for http://mycroft.jivox.com:8080/browse/ADPTL-4570
									glowClass = document.getElementById('glowStyleContainer').styleSheet.cssText + glowClass;
									document.getElementById('glowStyleContainer').styleSheet.cssText = glowClass;									
								}
							}
							
							var actionBtnRef = 
							$('<img src='+actionBtnIconURL+' id='+component+' class="components " highlightSelected = '+actionBtnOptions['highlightSelected']+' />').appendTo('#' + sceneId).show();
							
							actionBtnRef.bind({
							"mouseover" : function(){
								$(this).addClass('shadowGlow' + $(this).attr('id'));
							}
							,"mouseout" : function(){
								if($(this).attr('id') == 'custom' + actionButtonEventId && $(this).attr('highlightSelected') == 1){
									// Do not remove the class during mouse out if its respective OW launched and it has "selected" state set 
									return;
								}
								$(this).removeClass('shadowGlow' + $(this).attr('id'));
							}
							});

							if(clickActionType != 'no-action' && clickActionType != "trigger"){// for "no action" action buttons do not launch o/w
								actionBtnRef.css({'cursor':'pointer'}).bind({
								"click" : function(){
									$('#custom'+ actionButtonEventId).removeClass('shadowGlowcustom' + actionButtonEventId);
									that.launchOutputWin(this.id);
									that.invokeSecondaryAction(this.id);
									abMsg(this.id + ".clicked");
								}
								});
							}else if(clickActionType == 'no-action'){
																actionBtnRef.css({'cursor':'pointer'}).bind({
									"click" : function(){
										$('#custom'+ actionButtonEventId).removeClass('shadowGlowcustom' + actionButtonEventId);
										$(".baseContainer").trigger('click');
										abMsg(this.id + ".clicked");
									}
								});
															}else if(clickActionType == "trigger") {
								if(actionBtnOptions.hasOwnProperty('invokeOn') && actionBtnOptions['invokeOn'] == '1') {
									actionBtnRef.css({'cursor':'pointer'}).bind({
										"mouseover" : function(){
											that.invokeSecondaryAction(this.id);
											that.fireABEvent(this.id);
											abMsg(this.id + ".hovered");
										}
									});
								} else {
									actionBtnRef.css({'cursor':'pointer'}).bind({
										"click" : function(){
											that.invokeSecondaryAction(this.id);
											that.fireABEvent(this.id);
											abMsg(this.id + ".clicked");
										}
									});
								}
							}
						}
					}else{
														$('#' + component).show();
												
					}
						
					//populate action buttons that has transition properties in a JSON
					populateABTransitionJSON(component,actionBtnOptions);	
					populateShowHideAfterJSON(component,actionBtnOptions);
				}
			}
		}
	
		abTransitionJSONPopulated = true;
				setABTransitionTimers();
		
	//}
	elementsRendered  = true;
}


function hideAllHTML5Videos(){
	for(var videoId in videoElementsInScene){
		$("#" + videoId).css({
			"-webkit-transform":"translateX(-2048px)",
			"transform":"translateX(-2048px)", 
			"-moz-transform":"translateX(-2048px)",
			"-o-transform":"translateX(-2048px)",
			"-ms-transform":"translateX(-2048px)"
		});
	}
}

//pause AB transitions when unit is collapsed.
function pauseABTransitions(){
	for (var i in transitionTimersArray){
		clearTimeout(transitionTimersArray[i]);
	}
	transitionTimersArray = new Array(); //reset this array so that transitions are activated afresh.
	for(var t in abTransitionJSON){
		var transitionsForThisTime = abTransitionJSON[t];
        for(var obj in transitionsForThisTime){
			var el = transitionsForThisTime[obj].component;
			if(videoElementsInScene.hasOwnProperty(el) && thisBrowser == 'iPad'){
				$('#'+el).css({'opacity':0, 'display':'block'});
				$("#"+el).contents().find("div.videoWrapper").addClass("forceVideoHidden");
			} else {
				$('#' + el).hide();
			}
		}
	}
	for(var j in transitionStartedJSON) {
		delete transitionStartedJSON[j];
	}

	for (var a in abShowHideJSON) {
		var comp = abShowHideJSON[a];
		for(var b in comp) {
			if(comp[b].hasOwnProperty('showAfter') && !comp[b]['hasTransition']) {
				var el = comp[b]['component'];
				if(videoElementsInScene.hasOwnProperty(el) && thisBrowser == 'iPad'){
					$('#'+el).css({'opacity':0, 'display':'block'});
					$("#"+el).contents().find("div.videoWrapper").addClass("forceVideoHidden");
				} else {
					$('#' + el).css('display','none');
				}
			}
		}
	}

	transitionStartedJSON = {};
}

var abShowHideJSON = new Object();
var abPropJSON = {}; // stores all AB options for the current active layout scene.

function populateShowHideAfterJSON(component,actionBtnOptions){
	var showAfterComponent = actionBtnOptions['showAfter'];
	var hideAfterComponent = actionBtnOptions['hideAfter'];

	abPropJSON[component] = actionBtnOptions;

	var tmpJSON = {};
	if(typeof(showAfterComponent) != 'undefined') {
		var showCompList = showAfterComponent.split(",");
		for(var i in showCompList) {
			tmpJSON = {'component':component};
			tmpJSON['showAfter'] = showCompList[i];//showAfterComponent;
			if(typeof(actionBtnOptions['transitionType']) != 'undefined') {
				tmpJSON['hasTransition'] = true;
			} else {
				tmpJSON['hasTransition'] = false;
			}
			if(typeof(abShowHideJSON[component]) == 'undefined') {
				abShowHideJSON[component] = [tmpJSON];
			} else {
				abShowHideJSON[component].push(tmpJSON);
			}
		}
	}
	if(typeof(hideAfterComponent) != 'undefined') {
		var hideCompList = hideAfterComponent.split(",");
		for(var i in hideCompList) {
			tmpJSON = {'component':component};
			tmpJSON['hideAfter'] = hideCompList[i];//hideAfterComponent;
			if(typeof(actionBtnOptions['transitionOutType']) != 'undefined') {
				tmpJSON['hasTransition'] = true;
			} else {
				tmpJSON['hasTransition'] = false;
			}
			if(typeof(abShowHideJSON[component]) == 'undefined') {
				abShowHideJSON[component] = [tmpJSON];
			} else {
				abShowHideJSON[component].push(tmpJSON);
			}
		}
	}
	//console.log(abShowHideJSON);
}

/*
Populate action buttons that has transition properties in a JSON.
Takes action button id and action button options as input.
*/
function populateABTransitionJSON(component,actionBtnOptions){
	var abTransitionType = actionBtnOptions['transitionType'];
	var abTransitionOutType = actionBtnOptions['transitionOutType'];
	if(typeof(abTransitionType) != 'undefined' || typeof(abTransitionOutType) != 'undefined'){	
		var abTransitionTime = actionBtnOptions['transitionTime'];
		var abTransitionOutTime; //= (typeof(abTransitionTime) == 'undefined') ? actionBtnOptions['transitionOutTime'] : (parseInt(abTransitionTime) + parseInt(actionBtnOptions['transitionOutTime']));
		if(typeof(abTransitionTime) == 'undefined' || (typeof(actionBtnOptions['hideAfter']) != 'undefined')) {
			abTransitionOutTime = actionBtnOptions['transitionOutTime'];
		} else {
			abTransitionOutTime = (parseInt(abTransitionTime) + parseInt(actionBtnOptions['transitionOutTime']));
		}
		var tmpJSON = {'component':component};
		
		if(typeof(actionBtnOptions['showAfter']) != 'undefined') {
			tmpJSON['showAfter'] = actionBtnOptions['showAfter'];
		}
		if(typeof(actionBtnOptions['hideAfter']) != 'undefined') {
			tmpJSON['hideAfter'] = actionBtnOptions['hideAfter'];
		}

		if(typeof(abTransitionJSON[abTransitionTime]) == 'undefined'){	
			if(typeof(abTransitionType) != 'undefined'){
				tmpJSON['transition'] = "In";
				tmpJSON['transitionType'] = abTransitionType;
				abTransitionJSON[abTransitionTime] = [tmpJSON];
				transitionInEffectAB[component] = component;
				if(videoElementsInScene.hasOwnProperty(component) && thisBrowser == 'iPad'){
					$("#"+component).css({'opacity':0, 'display':'block'});
					$("#"+component).contents().find("div.videoWrapper").addClass("forceVideoHidden");
				} else {
					$('#' + component).css('display','none');	
				}
			}	
		}else{			
			if(typeof(abTransitionType) != 'undefined'){
				tmpJSON['transition'] = "In";
				tmpJSON['transitionType'] = abTransitionType;
				abTransitionJSON[abTransitionTime].push(tmpJSON);
				transitionInEffectAB[component] = component;
				if(videoElementsInScene.hasOwnProperty(component) && thisBrowser == 'iPad'){
					$("#"+component).css({'opacity':0, 'display':'block'});
					$("#"+component).contents().find("div.videoWrapper").addClass("forceVideoHidden");
				} else {
					$('#' + component).css('display','none');	
				}
			}			
		}

		tmpJSON = {'component':component};
		
		if(typeof(actionBtnOptions['showAfter']) != 'undefined') {
			tmpJSON['showAfter'] = actionBtnOptions['showAfter'];
		}
		if(typeof(actionBtnOptions['hideAfter']) != 'undefined') {
			tmpJSON['hideAfter'] = actionBtnOptions['hideAfter'];
		}

		if(typeof(abTransitionJSON[abTransitionOutTime]) == 'undefined'){
			if(typeof(abTransitionOutType) != 'undefined'){
				tmpJSON['transition'] = "Out";
				tmpJSON['transitionType'] = abTransitionOutType;				
				abTransitionJSON[abTransitionOutTime] = [tmpJSON];	
			}			
		}else{
			if(typeof(abTransitionOutType) != 'undefined'){
				tmpJSON['transition'] = "Out";
				tmpJSON['transitionType'] = abTransitionOutType;
				abTransitionJSON[abTransitionOutTime].push(tmpJSON);		
			}												
		}						
	}
	//console.log(abTransitionJSON);
}

function pauseInPlaceVideo(videoId){
	var videoElemId = (videoId != undefined) ? videoId : activeVideoIdInScene;
	try{
			getFlashMovieObject(videoElemId + 'PlaceHolder').jvxPauseAd();
		}catch(e){
			}
}

function resumeInPlaceVideo(videoId){
	var videoElemId = (videoId != undefined) ? videoId : activeVideoIdInScene;
	try{
					if($('#' + videoElemId).css('display') == 'none'){ 
				// video element is NOT visibile. So let's not resume
				return;
			}
			getFlashMovieObject(videoElemId + 'PlaceHolder').jvxResumeAd();
			}catch(e){

	}
}

function setABTransitionTimers(){
	var components = {};
	for(var t in abTransitionJSON){
		var transitionsForThisTime = abTransitionJSON[t];
		for(var tmpObj in transitionsForThisTime){	
			var currentComponent = transitionsForThisTime[tmpObj].component;
			components[currentComponent] = {};
			if(transitionInEffectAB[currentComponent]){
				if(videoElementsInScene.hasOwnProperty(currentComponent)){
					pauseInPlaceVideo(currentComponent);
					if(thisBrowser == 'iPad') {
						$("#"+currentComponent).css({'opacity':0, 'display':'block'});
						$("#"+currentComponent).contents().find("div.videoWrapper").addClass("forceVideoHidden");
					} else {
						$('#' + currentComponent).hide();
					}
				} else {
					$('#' + currentComponent).hide();
				}
				components[currentComponent]['transitionIn'] = 1;
			}else{
				if(videoElementsInScene.hasOwnProperty(currentComponent) && thisBrowser == 'iPad') {
					$("#"+currentComponent).css({'opacity':1, 'display':'block'});
					$("#"+currentComponent).contents().find("img.vidThumbnail").css("display", "none");
					$("#"+currentComponent).contents().find("div.videoWrapper").removeClass("forceVideoHidden");
				} else {
					$('#'+currentComponent).css({'display':'block','margin':'0'});
				}
				components[currentComponent]['transitionIn'] = 0;

			}
			if(typeof(transitionsForThisTime[tmpObj]['showAfter']) != 'undefined') {
				//do nothing
			} else {
				if(typeof(transitionsForThisTime[tmpObj]['hideAfter']) != 'undefined' && transitionsForThisTime[tmpObj]['transition'] == "Out") {
					//do nothing
				} else {
					var initVisible = abPropJSON[transitionsForThisTime[tmpObj]['component']]['initVisible'];
					var transition = transitionsForThisTime[tmpObj]['transition'];
					if((transition == "In" || transition == "Out") && initVisible == '0'){
						//do nothing
					} else {
						sendThisForTransition(t, transitionsForThisTime[tmpObj], 'auto');
					}
				}
			}
		}
	}
	var hideComponent = false;
	for(var i in abShowHideJSON) {
		if(typeof(components[i]) == 'undefined') {
			components[i] = {'transitionIn':0};
		}
		hideComponent = false;
		for(var j in abShowHideJSON[i]) {
			//console.log(abShowHideJSON[i][j]);
			if(typeof(abShowHideJSON[i][j]['showAfter']) != 'undefined') {
				hideComponent = true;
				if(!abShowHideJSON[i][j]['hasTransition']) {
					//$('#' + abShowHideJSON[i][j].component).hide();
					var tmpComponent = abShowHideJSON[i][j].component;
					if(videoElementsInScene.hasOwnProperty(tmpComponent)){
						pauseInPlaceVideo(tmpComponent);
						if(thisBrowser == 'iPad') {
							$("#"+tmpComponent).css({'opacity':0, 'display':'block'});
							$("#"+tmpComponent).load(function() {
								$(this).contents().find("div.videoWrapper").addClass("forceVideoHidden");
							});
						} else {
							$('#' + tmpComponent).hide();
						}
					} else {
						$('#' + tmpComponent).hide();
					}
				}
				if(components[i]){
					components[i]['showAfter'] = 1;
				}
			} else {
				if(typeof(abShowHideJSON[i][j]['hideAfter']) != 'undefined') {
					if(!abShowHideJSON[i][j]['hasTransition'] 
						&& !hideComponent 
						&& components[i]['transitionIn'] != 1) 
					{
						var tmpComponent = abShowHideJSON[i][j].component;
						if(videoElementsInScene.hasOwnProperty(tmpComponent)){
							if(thisBrowser == 'iPad') {
								$('#' + tmpComponent).css({'opacity':1, 'display':'block'});
								$("#"+tmpComponent).contents().find("img.vidThumbnail").css("display", "none");
								$("#"+tmpComponent).contents().find("div.videoWrapper").removeClass("forceVideoHidden");
							} else {
								$('#' + tmpComponent).css({'display':'block','margin':'0'});
							}
						} else {
							$('#' + tmpComponent).css({'display':'block','margin':'0'});
						}
					}
					if(components[i]){
						components[i]['hideAfter'] = 1;
					}
				}
			}
		}
	}

	for(var k in abPropJSON){ // code to implement initial appearence state when canvas loads
		var showAfter = abPropJSON[k]['showAfter'];
		var hideAfter = abPropJSON[k]['hideAfter'];
		var hasTransition = (typeof(abPropJSON[k]['transitionType']) != 'undefined' || typeof(abPropJSON[k]['transitionOutType']) != 'undefined');
		var initVisibleState = abPropJSON[k]['initVisible'];
		if(showAfter && initVisibleState == '1'){
			showActionButton(k, 'auto');
		} else if(!showAfter && hideAfter && initVisibleState == '0'){
			hideActionButton(k, 'auto');
		}
		
		if(!showAfter && !hideAfter && !hasTransition && initVisibleState == '0'){ 
			//no triggers, no delayed transitions, but initial appearence set to invisible
			$('#' + k).hide();
		}
	}
	//console.log(components);
	/*
	for(var vid in videoElementsInScene) {
		if(layout.isCloseOnDone(vid) == 1) {
			//console.log();
			if(!components.hasOwnProperty(vid) || (components.hasOwnProperty(vid) && (components[vid].hasOwnProperty('transitionIn') && components[vid].hasOwnProperty('transitionIn')!=1) && !components[vid].hasOwnProperty('showAfter'))) {
				$('#' + vid).css({'opacity':1, 'display':'block'});
				if(thisBrowser == 'iPad') {
					$("#"+vid).contents().find("img.vidThumbnail").css("display", "none");
					$("#"+vid).contents().find("div.videoWrapper").removeClass("forceVideoHidden");
				} 
			}
		}
	}*/
}

var transitionStartedJSON = {};
function sendThisForTransition(t, obj, trigger) {
	//console.log("sendThisForTransition:"+obj.component+"  "+obj.transition+"  "+t+" "+trigger);
	var comp = obj.component;
	if(typeof(transitionStartedJSON[comp]) == 'undefined') {
		var arr = [];
		arr[0] = {objectInTransition:obj, time:t, complete:0, started:1, trigger:trigger};
		transitionStartedJSON[comp] = arr;
	} else {
		transitionStartedJSON[comp].push({objectInTransition:obj, time:t, complete:0, started:1, trigger:trigger});
	}
	transitionTimersArray[transitionTimersArray.length] = {tInstance:setTimeout(function() { doThisABTransition(obj) }, t*1000), obj:obj.component, trigger:trigger}; //setTimeout(function() { doThisABTransition(obj) }, t*1000);
}

function abortThisTransition(t, obj, trigger) {
	//console.log("abortThisTransition");
	for(var i in transitionStartedJSON) {
		cObj = transitionStartedJSON[i];
		if(i == obj.component) {
			delete transitionStartedJSON[i];
		}
	}
	for(var tObj in transitionTimersArray) {
		if(transitionTimersArray[tObj].obj == obj.component) {
			clearTimeout(transitionTimersArray[tObj].tInstance);
			transitionTimersArray.splice(tObj, 1);
		}
	}
}

function prepareThisForTransition(t, obj, trigger) {
	//console.log("prepareThisForTransition:"+obj.component+" "+obj.transition+" "+trigger);
	//console.log(transitionStartedJSON);
	var found = false;
	var thisTransOver = false;
	var checkFurther = false;
	var abortThisTrans = false;
	for(var i in transitionStartedJSON) {
		cObj = transitionStartedJSON[i];
		if(i == obj.component) {
			found = true;
			//console.log("check cObj");
			//console.log(cObj);
			for(var j in cObj) {
				if(cObj[j].objectInTransition.transition != obj.transition) {
					//console.log(obj.component+"  "+obj.transition+"  "+cObj[j].started+"  "+cObj[j].complete);
					if(cObj[j].complete == 0) {
						//wait for this transition to get over
						putmeInPipeline(t, obj, trigger);
					} else if(cObj[j].started == 1 && cObj[j].complete == 1) {
						//start the transition
						//sendThisForTransition(t, obj);
						checkFurther = true;
					}
				} else {
					//console.log(cObj[j]);
					if(cObj[j].started == 1 && cObj[j].complete == 0) {
						//If the appearance/disappearance is triggered by same component then do not start new transition
						//However, if it is triggered by a different component then abort the existing transition
						if(cObj[j].trigger != trigger) {
							abortThisTransition(t, obj, cObj[j].trigger);
							sendThisForTransition(t, obj, trigger);
						}
					} else {
						thisTransOver = true;
					}
				}
			}
			//console.log(j+"  "+checkFurther+"  "+thisTransOver);
			if((checkFurther && thisTransOver) || (j==0 && thisTransOver)) {
				delete transitionStartedJSON[i];
				found = false;
			}
		}
	}
	if(!found || (checkFurther && !thisTransOver)) {
		if(thisBrowser == 'iPad' && videoElementsInScene.hasOwnProperty(obj.component)) {
			if((obj.transition == "Out" && $('#' + obj.component).css('opacity') == 0) || (obj.transition == "In" && $('#' + obj.component).css('opacity') == 1)) {
				//do nothing
			} else {
				sendThisForTransition(t, obj, trigger);
			}
		} else {
			if((obj.transition == "Out" && $('#' + obj.component).css('display') == 'none') || (obj.transition == "In" && $('#' + obj.component).css('display') == 'block')) {
				//do nothing
			} else {
				sendThisForTransition(t, obj, trigger);
			}
		}
	}
}

function putmeInPipeline(t, obj, trigger) {
	//console.log("putmeInPipeline:"+obj.component +"  "+obj.transition);
	var comp = obj.component;
	/*if(typeof(transitionStartedJSON[comp]) == 'undefined') {
		var arr = [];
		arr[0] = {objectInTransition:obj, time:t, complete:0, started:0};
		transitionStartedJSON[obj.component] = arr;
	} else {*/
		transitionStartedJSON[obj.component].push({objectInTransition:obj, time:t, complete:0, started:0, trigger:trigger});
	//}
	//transitionStartedJSON[obj.component].push({objectInTransition:obj, time:t, complete:0, started:0});
}

function doThisABTransition(obj) {
		//console.log("doThisABTransition");
		var el = obj.component;
		var elTransition = obj.transition;
		var elTransitionType = obj.transitionType;
		var transitionSetting = elTransitionType + elTransition;
		// this is needed before getting height and width. Otherwise we will get element height and width as 0.
		//$('#' + el).css({'display':'block','margin':'0'});
		if(videoElementsInScene.hasOwnProperty(obj.component)){
			//$('#' + obj.component).css({'opacity':'1','margin':'0'});
			//$('#' + obj.component).css({'display':'block','margin':'0'});
			if(thisBrowser == 'iPad') {
				$('#'+obj.component).css({'opacity':1, 'display':'block', 'margin':'0'});
				$("#"+obj.component).contents().find("img.vidThumbnail").css("display", "none");
				$("#"+obj.component).contents().find("div.videoWrapper").removeClass("forceVideoHidden");
			} else {
				$('#'+obj.component).css('background-color', '#000000');
				$('#'+obj.component).css({'display':'block','margin':'0'});
			}
		} else {
			$('#' + obj.component).css({'display':'block','margin':'0'});
		}
		var elWidth = $('#' + el).width();
		var elHeight = $('#' + el).height();
		var elLeft = $('#' + el).position().left;	
		var elRight = $('.scenesContainer').parent().width() - (elLeft + elWidth);
		var elTop = $('#' + el).position().top;	
		var elBottom = $('.scenesContainer').parent().height() - (elTop + elHeight);

		var leastDistFromLeft = false;
		var leastDistFromTop = false;
		var leastSpaceDir = 'left';
		var marginVal = 0;
		leastDistFromLeft = (elLeft < elRight) ? true : false;
		leastDistFromTop = (elTop < elBottom) ? true : false;

		if(leastDistFromLeft && leastDistFromTop){// left is the least dist in x axis. top is the least dist in y axis
			leastSpaceDir = (elLeft < elTop) ? 'left' : 'top';
		} else if(leastDistFromLeft && !leastDistFromTop){ // left is the least dist in x axis. bottom is the least dist in y axis
			leastSpaceDir = (elLeft < elBottom) ? 'left' : 'bottom';
		} else if(!leastDistFromLeft && leastDistFromTop){ // right is the least dist in x axis. top is the least dist in y axis
			leastSpaceDir = (elRight < elTop) ? 'right' : 'top';
		} else if(!leastDistFromLeft && !leastDistFromTop){ // right is the least dist in x axis. bottom is the least dist in y axis
			leastSpaceDir = (elRight < elBottom) ? 'right' : 'bottom';
		}


		var slideDir = '';

		if(elTransition == 'In'){
					}
		if(elTransition == 'Out'){
					}
		
		if(leastSpaceDir == 'left'){
			slideDir = 'margin-left';
			marginVal = -(elLeft+elWidth);
		} else if(leastSpaceDir == 'top'){
			slideDir = 'margin-top';
			marginVal = -(elTop+elHeight);
		} else if(leastSpaceDir == 'right'){
			slideDir = 'margin-left';
			marginVal = elRight + elWidth;
		} else if(leastSpaceDir == 'bottom'){
			slideDir = 'margin-top';
			marginVal = elBottom + elHeight;
		}
		
		switch(transitionSetting){
			case "fadeIn":
				$('#' + el).css({'opacity':0}).animate({opacity:1},abTransitionSpeed, function() {
															if(thisBrowser == 'iPad' && videoElementsInScene.hasOwnProperty($(this).attr('id'))) {
																$(this).contents().find("img.vidThumbnail").css("display", "none");
																$(this).contents().find("div.videoWrapper").removeClass("forceVideoHidden");
															}
														});
				if(videoElementsInScene.hasOwnProperty(el)){
					if(actionButtonEventId != '') {
						setTimeout(function(){pauseInPlaceVideo(el)}, 300);
					}
				}
				break;
			case "fadeOut":						
				if(videoElementsInScene.hasOwnProperty(el)){
					pauseInPlaceVideo(el);
				}
				$('#' + el).fadeOut(abTransitionSpeed);
				break;
			case "slideIn":	
				var animateJSON = {};
				animateJSON[slideDir] = '0px';
				var cssJSON = {};
				cssJSON[slideDir] = marginVal + 'px';
				if(videoElementsInScene.hasOwnProperty(el)){
					if(actionButtonEventId != '') {
						setTimeout(function(){pauseInPlaceVideo(el)}, 300);
					}
				}
				$('#' + el).css(cssJSON).animate(animateJSON,abTransitionSpeed, function() {
															if(thisBrowser == 'iPad' && videoElementsInScene.hasOwnProperty($(this).attr('id'))) {
																$(this).contents().find("img.vidThumbnail").css("display", "none");
																$(this).contents().find("div.videoWrapper").removeClass("forceVideoHidden");
															}
														});
				break;
			case "slideOut":	
				var animateJSON = {};
				animateJSON[slideDir] = marginVal + 'px';
				if(videoElementsInScene.hasOwnProperty(el)){
					pauseInPlaceVideo(el);
					/*$('#' + el).animate(animateJSON,abTransitionSpeed,function(){$(this).css({'opacity':0, 'display':'block'})});
				} else {
 					$('#' + el).animate(animateJSON,abTransitionSpeed,function(){$(this).css('display','none')});*/
				}
				$('#' + el).animate(animateJSON,abTransitionSpeed,function(){
																	if(thisBrowser == 'iPad' && videoElementsInScene.hasOwnProperty($(this).attr('id'))) {
																		$(this).css('opacity', 0);
																	} else {
																		$(this).css('display','none');
																	}
																  });
				break;
			default:
				break;
		}
		for (var i in transitionStartedJSON[obj.component]) {
			var cObj = transitionStartedJSON[obj.component][i];
			//console.log("doThisTransition:"+obj.component);
			//console.log(cObj);
			if(cObj.objectInTransition.transition == obj.transition && cObj.objectInTransition.transitionType == obj.transitionType) {
				//console.log(obj.component+"  transition complete "+obj.transition);
				cObj['complete'] = 1;
			} else if(cObj['started'] == 0 && cObj['complete'] == 0) {
				//console.log("starting next transition:"+obj.component+"  "+obj.transition);
				sendThisForTransition(cObj.time, cObj.objectInTransition, 'next');
			}
		}
}
//method that takes care of rendering components
layouter.prototype.renderLayout = function(){	
	var that = this;
	adUnitWidth = 640;
	adUnitHeight = 480;

	if(this.activeScene == undefined || this.activeScene == null){
		this.activeSceneId = "scene-1";
	}

	if(isInterstitial){
		adUnitWidth = document.documentElement.clientWidth;
		adUnitHeight = document.documentElement.clientHeight;	
	}

	var matchedLayout = this.getLayoutData();
	var matchedLayoutDim = matchedLayout[0];
	var matchedLayoutData = matchedLayout[1];
	this.layoutData = matchedLayoutData;

	if(this.layoutData == null || this.layoutData == undefined){ 
		/* This is to handle cases like where web expand units have customized dimensions. 
		   So it won't find a match of the viewport with the one that BE returns. 
		   So we'll just match the value that BE returns.
		*/
		for(var i in nestedLayoutJSON['layout'][this.adUnitTypeStr]){
		  this.layoutData = nestedLayoutJSON['layout'][this.adUnitTypeStr][i];	
		  matchedLayoutDim = i;
		}
	}
	
	this.matchedLayoutDim = matchedLayoutDim;
	this.applyDefaultLayout(matchedLayoutDim);

	
	this.renderLayoutContainerAndPlayer();
	if(!syncUnitLoad) {
				// fix for http://mycroft.jivox.com:8080/browse/ADPTL-4427
		setTimeout(function(){that.renderLayoutComponents()},1000);
			}
}

var clickedPrimaryAB = {};

/**
	Fire event for trigger type action button click/mouseover
*/
layouter.prototype.fireABEvent = function(actionBtnId) {
	var actionBtnCompleteId = this.getCompleteActionButtonId(actionBtnId);
	var actionBtnDetails = actionButtonsJSON[actionBtnCompleteId];
	var eventType = actionBtnDetails['eventType'];
	
		fireExternalTracker("http://evs.jivox.com/jivox/serverAPIs/saveImpression.php?" + serialize({"campaignId":"47863", "siteId" : "2521715ca13bed", "clickThrough" : eventType, "jvxSessionId" : 1380317264.9409, "adUnitType" : "9", "es_pId" : ""}));
	}
/**
	Invoke secondary action to show/hide another action button
*/
layouter.prototype.invokeSecondaryAction = function(actionBtnId) {
	//Check dependant action buttons in show/hide info JSON
	//console.log("invokeSecondaryAction");
	var secInvokeComp = null;
	for(var abid in abShowHideJSON) {
		for(var arrInd in abShowHideJSON[abid]) {
			secInvokeComp = null;
			if(abShowHideJSON[abid][arrInd]['showAfter'] == actionBtnId) {
				secInvokeComp = abShowHideJSON[abid][arrInd]['component'];
				showActionButton(secInvokeComp, actionBtnId);
			}
			if(abShowHideJSON[abid][arrInd]['hideAfter'] == actionBtnId) {
				secInvokeComp = abShowHideJSON[abid][arrInd]['component'];
				hideActionButton(secInvokeComp, actionBtnId);
			} 
		}
	}
}

function showActionButton(actionBtnId, trigger){
	if(typeof(trigger) == 'undefined') {
		trigger = '';
	}
	var doTransitionOut = false;
	var isHideAfterSet = abPropJSON[actionBtnId]['hideAfter'];

	var showAfter = abPropJSON[actionBtnId]['showAfter'];
	var hideAfter = abPropJSON[actionBtnId]['hideAfter'];
	var hasTransition = (typeof(abPropJSON[actionBtnId]['transitionType']) != 'undefined' || typeof(abPropJSON[actionBtnId]['transitionOutType']) != 'undefined');

	if(!showAfter && !hideAfter && !hasTransition){ 
		// This is to handle cases when no triggers, no transition effects configured but a widget wants to show a certain action button
		$('#' + actionBtnId).show();
	}

	for(var t in abTransitionJSON){
		var transitionsForThisTime = abTransitionJSON[t];
		for(var tmpObj in transitionsForThisTime){			
			if(actionBtnId!=null && transitionsForThisTime[tmpObj].component == actionBtnId && transitionsForThisTime[tmpObj]['transition'] != "Out"){
				prepareThisForTransition(t, transitionsForThisTime[tmpObj], trigger);
			} else if(transitionsForThisTime[tmpObj].component == actionBtnId && transitionsForThisTime[tmpObj]['transition'] == "Out") {
				doTransitionOut = true;
			}
		}
	}
	for (var arrInd in abShowHideJSON[actionBtnId]){
		if(typeof(abShowHideJSON[actionBtnId][arrInd]['showAfter']) != 'undefined' && !abShowHideJSON[actionBtnId][arrInd]['hasTransition']){
			//$('#' + actionBtnId).css({'display':'block','margin':'0'});
			if(videoElementsInScene.hasOwnProperty(actionBtnId)){
				var actionBtnCompleteId = layout.getCompleteActionButtonId(actionBtnId);
				var actionBtnDetails = actionButtonsJSON[actionBtnCompleteId];
				if(actionButtonEventId != '') {
					if(outputWindowType == 'default' || outputWindowType == 'overlayPlayer') {
						setTimeout(function(){pauseInPlaceVideo(actionBtnId)}, 200);
					}
				} else if(actionBtnDetails['autoPlay'] == 1) {
					resumeInPlaceVideo(actionBtnId);
				}
				if(thisBrowser == 'iPad') {
					$('#'+actionBtnId)
                                        .css({'opacity':1, 'display':'block', margin: 0})
                                        .contents().find("img.vidThumbnail").css("display", "none");
					
					//$("#"+actionBtnId).contents().find("div.videoWrapper").removeClass("forceVideoHidden");
					if($("#"+actionBtnId).contents().find("div.videoWrapper").length == 0) {
						$("#"+actionBtnId).load(function() {
							$(this).contents().find("div.videoWrapper").removeClass("forceVideoHidden");
						});
					} else {
						$("#"+actionBtnId).contents().find("div.videoWrapper").removeClass("forceVideoHidden");
					}
				} else {
					$('#' + actionBtnId).css({'display':'block','margin':'0'});
				} 
			} else {
				$('#' + actionBtnId).css({'display':'block','margin':'0'});
			}
		}
	}
	if(actionBtnId != null && doTransitionOut && !isHideAfterSet) {
		//prepareThisForTransition(t, transitionsForThisTime[tmpObj]);
		for(t in abTransitionJSON) {
			var transitionsForThisTime = abTransitionJSON[t];
			for(var tmpObj in transitionsForThisTime){
				if(transitionsForThisTime[tmpObj].component == actionBtnId) {
					prepareThisForTransition(t, transitionsForThisTime[tmpObj], trigger);
				}
			}
		}
	}
}

function hideActionButton(actionBtnId, trigger){

	if(typeof(trigger) == 'undefined') {
		trigger = '';
	}
	var showAfter = abPropJSON[actionBtnId]['showAfter'];
	var hideAfter = abPropJSON[actionBtnId]['hideAfter'];
	var hasTransition = (typeof(abPropJSON[actionBtnId]['transitionType']) != 'undefined' || typeof(abPropJSON[actionBtnId]['transitionOutType']) != 'undefined');

	if(!showAfter && !hideAfter && !hasTransition){ 
		// This is to handle cases when no triggers, no transition effects configured but a widget wants to hide a certain action button
		$('#' + actionBtnId).hide();
	}

	for(var t in abTransitionJSON){
		var transitionsForThisTime = abTransitionJSON[t];
		for(var tmpObj in transitionsForThisTime){			
			if(actionBtnId!=null && transitionsForThisTime[tmpObj].component == actionBtnId && transitionsForThisTime[tmpObj]['transition'] != "In"){
				hasTransitionEffect = true;
				prepareThisForTransition(t, transitionsForThisTime[tmpObj], trigger);
			}
		}
	}
	for (var arrInd in abShowHideJSON[actionBtnId]){
		if(typeof(abShowHideJSON[actionBtnId][arrInd]['hideAfter']) != 'undefined' && !abShowHideJSON[actionBtnId][arrInd]['hasTransition']) {
			//$('#' + actionBtnId).hide();
			if(videoElementsInScene.hasOwnProperty(actionBtnId)){
				pauseInPlaceVideo(actionBtnId);
				if(thisBrowser == 'iPad') {
					$("#"+actionBtnId).css({'opacity':0, 'display':'block'});
					$("#"+actionBtnId).contents().find("div.videoWrapper").addClass("forceVideoHidden");
				} else {
					$('#' + actionBtnId).hide();
				}
			} else {
				$('#' + actionBtnId).hide();
			}
		}
	}
}

layouter.prototype.launchOutputWin = function(actionBtnId, widgetId){
	
	var actionBtnCompleteId = this.getCompleteActionButtonId(actionBtnId);
	var actionBtnDetails = actionButtonsJSON[actionBtnCompleteId];
	var clickActionType = actionBtnDetails['type'];

	if(clickActionType == 'no-action' || clickActionType == 'inline-video' || clickActionType == 'trigger'){
		//for these type of action buttons there is nothing to launch in OW or as an external URL.
		return;
	}

	if(actionButtonEventId != ''){
		// record close event for already open custom output window. Fix for http://mycroft.jivox.com:8080/browse/PBPTL-652
		closeActionBtnDetailPanel(false);
	}

	var closeOWVideoAtCompletion = 0;
	var outputWinId = actionBtnId + '.outputWindow';
	if(widgetId != undefined){
		outputWinId = widgetId + '.outputWindow';
	} else {
		closeOWVideoAtCompletion = this.isCloseOWVideoAtCompletion(actionBtnId);
	}
	var outputWinDetails = this.outputWinJSON[outputWinId];
	var actionButtonId = actionBtnId.replace("custom", "");
	actionButtonId = parseInt(actionButtonId);

	var key = actionBtnCompleteId;
	var data = actionBtnDetails['data'];
	var shareUrlType = actionBtnDetails['shareUrlType'];
	var shareMsg = actionBtnDetails['shareMsg'];
	var eventType = actionBtnDetails['eventType'];
	var externalStartEventId = eventType * 100;// give the start event id to SWF/WIDGET creators
	var assetDim = actionBtnDetails['assetDimension'];
	var assetBgColor = actionBtnDetails['assetBgColor'];
	var autoPlay = actionBtnDetails['autoPlay'];

	var youTubeURL = '';
	
	if(clickActionType == 'youtube'){
		youTubeURL = "http://www.youtube.com/embed/" + data + "?wmode=transparent&autoplay="+autoPlay;
		$("#closeActionBtnLaunchPad").attr("controlType", "video");
	}
	actionButtonEventId = eventType;
	
		//record impression for custom interaction.
		fireExternalTracker("http://evs.jivox.com/jivox/serverAPIs/saveImpression.php?" + serialize({"campaignId":"47863", "siteId" : "2521715ca13bed", "clickThrough" : eventType, "jvxSessionId" : 1380317264.9409, "adUnitType" : "9", "es_pId" : ""}));
		//$.get("/jivox/serverAPIs/saveImpression.php", {"campaignId":"47863", "siteId" : "2521715ca13bed", "clickThrough" : eventType, "jvxSessionId" : 1380317264.9409, "adUnitType" : "9", "r" : $.now()} );
		
		
	if(clickActionType=='url'){	
		data = primaryTrackersJSON[actionButtonId] ? primaryTrackersJSON[actionButtonId] : data;
				var actionButtonTargetSelfIdArr = [""];
		if(typeof(actionButtonTargetSelfIdArr) != "undefined" && $.isArray(actionButtonTargetSelfIdArr)){
			var actionButtonTargetSelfId = 0;
			for(actionButtonTargetSelfId in actionButtonTargetSelfIdArr){
				if(actionButtonId == actionButtonTargetSelfIdArr[actionButtonTargetSelfId]){
					window.location.href = data;
					return;
				}
			}
			window.open(data);
			actionButtonEventId = '';//set to empty so that we don't record close events for AB that launch URLs outside expansion unit
		}		
		else{
			window.open(data);
			actionButtonEventId = '';//set to empty so that we don't record close events for AB that launch URLs outside expansion unit
		}
				pauseAllVideos();
		return;
	} else if(clickActionType == 'fbshare' || clickActionType == 'twittershare' || clickActionType == 'gplusshare'){
		var socialShareURL = '';
		var shareURL = encodeURIComponent('http://slate.jivox.com/advertiser/landingPage.php?id=47863');
		if(shareUrlType == "custom"){
			shareURL = encodeURIComponent(data);
		}
		if(clickActionType == 'fbshare'){
			if(shareUrlType == "custom"){
				socialShareURL = "http://www.facebook.com/sharer.php?u="+shareURL+"&t="+shareMsg;
			}else{
				socialShareURL = "http://www.facebook.com/sharer.php?u="+shareURL+"%26ref=facebook&t="+shareMsg;
			}
		} else if(clickActionType == 'twittershare'){
			if(shareUrlType == "custom"){
				socialShareURL = "http://twitter.com/share?text="+shareMsg+"&url="+shareURL;
			}else{
				socialShareURL = "http://twitter.com/share?text="+shareMsg+"&url="+shareURL+"%26ref=twitter";
			}
		} else if(clickActionType == 'gplusshare'){
			if(shareUrlType == "custom"){
				socialShareURL = "https://plus.google.com/share?url=" + shareURL;
			}else{
				socialShareURL = "https://plus.google.com/share?url=" + shareURL +"%26ref=plus";
			}
		}
		window.open(socialShareURL);
		actionButtonEventId = '';//set to empty so that we don't record close events for AB that launch URLs outside expansion unit
		pauseAllVideos();
	} else if(clickActionType == "closeExpansion" || clickActionType == "openExpansion"){
		if(clickActionType == "openExpansion") pauseVideo(activeVideoIdInScene);
		window.parent.postMessage('jvxAdPlayer_5245f850874f99_49863897:' + (clickActionType == "closeExpansion" ? 'slideInLargeAdUnit' : 'slideOutLargeAdUnit') + ':preventSlideEvent', "*");
	} else {
		outputWindowType = 'default';//set to default at first
		var outputWindowCloseBtn  = false;
		
		if(typeof outputWinDetails !== 'undefined'){			
			var outputWinOptions = outputWinDetails['options'];	
			var outputWinLocation = outputWinDetails['location'];	
			var outputWinLocationAndDim = [];
			if(outputWinLocation != null && outputWinLocation != undefined){
				outputWinLocationAndDim = outputWinLocation.split(',');
			}
			outputWindowType = outputWinOptions['outputWindowType'];
			outputWindowCloseBtn = (outputWinOptions['outputWindowCloseBtn'] == undefined || outputWinOptions['outputWindowCloseBtn'] == 1) ? true : false;
		}
		var outputWinWidth = 0;
		var outputWinHeight = 0;
		var outputWinTop = 0;
		var outputWinLeft = 0;
		var outputWinCSS = {};
		var outputWinCloseBtnCSS = {};
		if(outputWindowType == 'default'){
			var outputWinDim = getOutputWinSize(assetDim,clickActionType);
			var outputWinPosn = getOutputWinPosn(outputWinDim);
			outputWinWidth = outputWinDim[0];//get the output window dimension from output content dimension
			outputWinHeight = outputWinDim[1];
			outputWinTop = outputWinPosn[0];
			outputWinLeft = outputWinPosn[1];
		}else if(outputWindowType == 'overlayPlayer'){
			outputWinWidth = playerWidth;
			outputWinHeight = playerHeight;
			var playerPosn = $('#player').position();
			outputWinTop = playerPosn.top;
			outputWinLeft = playerPosn.left;
		}else if(outputWindowType == 'custom'){
			outputWinWidth = outputWinLocationAndDim[2];
			outputWinHeight = outputWinLocationAndDim[3];
			outputWinTop = outputWinLocationAndDim[1];
			outputWinLeft = outputWinLocationAndDim[0];
		}
		
		outputWinCSS.width = outputWinWidth + "px";
		outputWinCSS.height = outputWinHeight + "px";
		outputWinCSS.top = outputWinTop + "px";
		outputWinCSS.left = outputWinLeft + "px";

		var outputWinCloseBtnTop = parseInt(outputWinTop);		
		var outputWinCloseBtnLeft = parseInt(outputWinLeft) + parseInt(outputWinWidth);		
				  outputWinCloseBtnLeft = parseInt(outputWinCloseBtnLeft) - parseInt(24);
				outputWinCloseBtnCSS.top = outputWinCloseBtnTop + "px";
		outputWinCloseBtnCSS.left = outputWinCloseBtnLeft + "px";
				
		if(clickActionType == "video"){
			$("#closeActionBtnLaunchPad").attr("controlType", "video");
		}

		/* Fix for ADPTL-4553 */
		if(this.isIPanelOverlay == 1){
		  jvxAdPlayer_5245f850874f99_49863897.autoSlideInInteractivity(null,null);
		}

		stopSecondaryVideo();
		if(outputWindowType == 'default' || outputWindowType == 'overlayPlayer' || clickActionType == "video" || clickActionType == 'youtube'){
						pauseAllVideos();
			if(outputWindowType == 'default'){
				$("#mask").css({'width':document.documentElement.scrollWidth,'height':document.documentElement.scrollHeight}).show();
			}
		}

				
		$("#actionBtnLaunchPad").hide().css(outputWinCSS);
		$("#closeActionBtnLaunchPad").hide();

		try{
			var iFrameDoc = $("#actionBtnLaunchPad")[0].contentWindow.document; 
			iFrameDoc.open();
			iFrameDoc.close();
			var loaderHTML = $('<style>body{background-color:#000;}</style><div style="text-align: center; margin-top: -16px;position:absolute;top:50%;padding:0;margin:0;border:0 none;background:#000000;opacity:0.8;"><img alt="Loading..." src="http://as.jivox.com/advertiser/images/loader-animation-2.gif"></div>').css({"width": outputWinCSS.width, "height": outputWinCSS.height});
			$("body", iFrameDoc).append(loaderHTML);
		}catch(e){
			$('#actionBtnLaunchPad').attr("src", "http://as.jivox.com/player/blank.html");
		}

		$("#actionBtnLaunchPad").show();

		var flashPluginParam = flashplugin ? '' : '&flashplugin=0'; //pass this param to customInteraction.php when flash support is not there.
		var fallbackType = actionBtnDetails['fallbackType'];
		var fallbackWidgetURL = actionBtnDetails['fallbackWidgetURL'];

		if(clickActionType == 'file-upload' && !flashplugin && fallbackWidgetURL){
			var apiVars = '';
						apiVars = '?campaignId=47863&siteId=2521715ca13bed&jvxSessionId=1380317264.9409&adUnitType=9&clickTagURL=http%3A%2F%2Fevs.jivox.com%2Fjivox%2FserverAPIs%2FexternalReporting%2Fproxy.php%3FcampaignId%3D47863%26siteId%3D2521715ca13bed%26adUnitType%3D9%26es_pId%3D%26jvxSessionId%3D1380317264.9409%26clickTagURL%3Dhttp%253A%252F%252Fadclick.g.doubleclick.net%252Faclk%253Fsa%253DL%2526ai%253DB4Z7GUPhFUpLQE-vP0AG93ICIDaqowo0EAAAAEAEgwqCnDjgAWOqL5uphYMnGqYvApNgPsgEWd3d3LmNvc21vZW5lc3Bhbm9sLmNvbboBCzAwZ2ZwX2ltYWdlyAEJ2gEmaHR0cDovL3d3dy5jb3Ntb2VuZXNwYW5vbC5jb20vZmFzaGlvbi-pAo2ngfDMYXQ-wAIC4AIA6gI-LzcxODcvdGVsZXZpc2EuZWRpdG9yaWFsLmNvc21vZW5lc3Bhbm9sL2Nvc21vZW5lc3Bhbm9sLmZhc2hpb274AoHSHpAD4AOYA6QDqAMB0ASQTuAEAaAGIA%2526num%253D0%2526sig%253DAOD64_1auFdJJrgb5qh-EFPUxfZCfZCLWw%2526client%253Dca-pub-7798366957477628%2526adurl%253Dhttp%253A%252F%252Fwww.MiPantene.com&eventReportingURL=http://evs.jivox.com/jivox/serverAPIs/saveImpression.php&externalStartEventId=' + externalStartEventId;
						$("#actionBtnLaunchPad").attr("src", fallbackWidgetURL + apiVars);
		} else {		
			if(clickActionType == 'youtube'){
				$("#actionBtnLaunchPad").attr("src", youTubeURL);
			}else if(clickActionType.indexOf("gallery") == 0){
				var mediaGallerySrc =  mediaGalleryURL.replace("_version_", (isNaN(parseInt(widgetsJSON["customWidget."+clickActionType].version)) ? "1" : widgetsJSON["customWidget."+clickActionType].version));
				mediaGallerySrc += "&component="+clickActionType+"&inOW=1";
				mediaGallerySrc += "&scrollByThumbnails=true";
				mediaGallerySrc += "&isMobile=0";
										mediaGallerySrc += "&inAppEmbeddedBrowser=0";
					mediaGallerySrc += "&playerEventURL=/jivox/serverAPIs/saveImpression.php";
					mediaGallerySrc += "&adUnitType=9";
									$("#actionBtnLaunchPad").attr("src", mediaGallerySrc);
			}else{
				$("#actionBtnLaunchPad").attr("src", "http://as.jivox.com/player/customInteraction.php?id=47863&expandAsInterstitial=1&t=1380317264318&r=0.4445457870606333&creativeUnitType=14&creativeUnitWidth=640&creativeUnitHeight=480&siteId=2521715ca13bed&campaignId=47863&clickTagURL=http%3A%2F%2Fadclick.g.doubleclick.net%2Faclk%3Fsa%3DL%26ai%3DB4Z7GUPhFUpLQE-vP0AG93ICIDaqowo0EAAAAEAEgwqCnDjgAWOqL5uphYMnGqYvApNgPsgEWd3d3LmNvc21vZW5lc3Bhbm9sLmNvbboBCzAwZ2ZwX2ltYWdlyAEJ2gEmaHR0cDovL3d3dy5jb3Ntb2VuZXNwYW5vbC5jb20vZmFzaGlvbi-pAo2ngfDMYXQ-wAIC4AIA6gI-LzcxODcvdGVsZXZpc2EuZWRpdG9yaWFsLmNvc21vZW5lc3Bhbm9sL2Nvc21vZW5lc3Bhbm9sLmZhc2hpb274AoHSHpAD4AOYA6QDqAMB0ASQTuAEAaAGIA%26num%3D0%26sig%3DAOD64_1auFdJJrgb5qh-EFPUxfZCfZCLWw%26client%3Dca-pub-7798366957477628%26adurl%3Dhttp%3A%2F%2Fwww.MiPantene.com&objectName=jvxAdPlayer_5245f850874f99_49863897&lDim=640x480&expandUnitType=&adUnitType=9&expandedUnit=1&viewLayout=&adUnitWidth=640&adUnitHeight=480&jvxSessionId=1380317264.9409&height="+outputWinHeight+"&width="+outputWinWidth+"&key=" + actionBtnCompleteId + "&assetBgColor=" + assetBgColor + "&closeOWVideoAtCompletion="+closeOWVideoAtCompletion +"&eventType=" + eventType + flashPluginParam);
			}
		}

		if(outputWindowType == 'default' || outputWindowCloseBtn){
			$("#closeActionBtnLaunchPad").css(outputWinCloseBtnCSS).show();
		}

		actionBtnPanelTimer = setInterval(function(){ actionBtnTimeElapsed = actionBtnTimeElapsed+1; }, 1000);
			}
}

layouter.prototype.isCloseOWVideoAtCompletion = function(componentId, widgetId){
	var pre = 0;
	var sceneId = this.activeSceneId;
	var layoutScenes = this.layoutData['scenes'];
	var scene = layoutScenes[sceneId]['components'];

	if(scene[componentId] && scene[componentId]['options'].hasOwnProperty('closeOWVideoAtCompletion')) {
		if(scene[componentId]['options']['closeOWVideoAtCompletion'] == 1) {
			pre = 1;
		}
	}
	scene = null;
	layoutScenes = null;
	return pre;
}

layouter.prototype.isCloseOnDone = function(componentId){
	var pre = 0;
	var sceneId = this.activeSceneId;
	var layoutScenes = this.layoutData['scenes'];
	var scene = layoutScenes[sceneId]['components'];

	if(scene[componentId]['options'].hasOwnProperty('clsOnDone')) {
		if(scene[componentId]['options']['clsOnDone'] == 1) {
			pre = 1;
		}
	}
	scene = null;
	layoutScenes = null;
	return pre;
}

layouter.prototype.getCompleteActionButtonId = function(componentId){
	return "customInteraction." + componentId;
}


layouter.prototype.applyDefaultLayout = function(layoutMatch){
	if(null != layoutMatch){
		var cords = layoutMatch.split("x");
		var layoutWidth = (typeof(cords[0]) != "undefined") ? cords[0] : 0;
		var layoutHeight = (typeof(cords[1]) != "undefined") ? cords[1] : 0;
		layoutWidth = parseInt(layoutWidth);
		layoutHeight = parseInt(layoutHeight);
		var orientationMode = "portrait";
		
		if(layoutWidth > layoutHeight){
			orientationMode = "landscape";
		}

		$("body").attr("class", ""+orientationMode+layoutMatch+this.activeSceneId+"");
			}
}

//get the filtered layout data from complete layout data
layouter.prototype.getLayoutData = function(){
	/* checking for $inAppEmbeddedBrowser is needed because the web expanding units take some time to complete the animation and reach the final width and height. if this code is called before animation is complete, we don't get the correct width and height. So, for those cases use the ad unit width and height.
	*/
	var vpWidth = 640;
	var vpHeight = 480;	

	if(isInterstitial){		
		vpWidth = document.documentElement.clientWidth;
		vpHeight = document.documentElement.clientHeight;	
	}
	
		
	this.setOrientation(vpWidth,vpHeight);
	this.width =  vpWidth;
	this.height = vpHeight;
	var layoutMatch = this.getClosest(vpWidth, vpHeight, globalLayoutAreaJSON);
	var layout = nestedLayoutJSON['layout'];
	var layoutJSON = {};
		for(var layoutType in layout) {
		for(var unitType in layout[layoutType]) {
			if(unitType == 14) {
				layoutJSON = layout[layoutType][unitType];
				break;
			}
		}
	}
	//console.log(layoutJSON);
	return [layoutMatch, layoutJSON[layoutMatch]];
}

layouter.prototype.setOrientation = function(w,h){
	this.orientation = w > h ? "landscape" : "portrait";
}

layouter.prototype.getOrientation = function(w,h){
	var orientation = w > h ? "landscape" : "portrait";
	return orientation;			
}

layouter.prototype.orientationChangeHandler = function(){
	if(this.width == document.documentElement.clientWidth && this.height == document.documentElement.clientHeight){
		this.orientationChangeHandler();
		return;
	}	

	pauseAllVideos();
	hideAllHTML5Videos();
	pauseABTransitions();
	abTransitionJSON = {};//When orientation changes, reset the JSON that stores AB that are enabled with transitions.
	abTransitionJSONPopulated = false;
	if(activeVideoIdInScene != "") {
		currOrientActiveVideoIdInScene = (prevOrientActiveVideoIdInScene=="") ? activeVideoIdInScene : prevOrientActiveVideoIdInScene;
		prevOrientActiveVideoIdInScene = activeVideoIdInScene;
	}
	activeVideoIdInScene = "";
	abPropJSON = {};

    hideAddressBar();
	stopSecondaryVideo();	
	$('#secondaryVideo, .closeSecondaryVideo').remove(); //Fix for http://mycroft.jivox.com:8080/browse/ADPTL-5024
	closeActionBtnDetailPanel(false);// close output window if anything is open
	this.renderLayout();
}

layouter.prototype.init = function(){
	var that = this;
	this.adUnitTypeStr = adUnitTypeStr;
	this.renderLayout();
		}

var layout =  new layouter();
layout.init();
/* LAYOUTER JS ENDS */
</script><div id="scene-1"><img src="24238-0-pro-521f8d41e2be0.png" id="custom104" class="components " highlightselected="undefined" style="cursor: pointer;"><img src="24238-0-pro-521f8d61825b4.png" id="custom105" class="components " highlightselected="undefined" style="cursor: pointer;"><img src="24238-61450-pro-521fa50d975f5.jpg" id="custom106" class="components " highlightselected="undefined" style="cursor: pointer;"><img src="24238-61450-pro-521fa517bf08a.jpg" id="custom107" class="components " highlightselected="undefined" style="cursor: pointer;"><img src="24238-61450-pro-521fc179d967a.png" id="custom110" class="components " highlightselected="undefined" style="cursor: pointer;"><div id="custom111" class="components"><object type="application/x-shockwave-flash" data="http://as.jivox.com/player/InteractivityPlayer.swf?inplace=1&adUnitType=9&reportingURL=http://evs.jivox.com&campaignId=47863&siteId=2521715ca13bed&expandedUnitPlayerVolume=1&expandedUnit=1&expandUnitType=&videoFile=http://cdn.jivox.com/47863/3/WP1_24238_47863_61854_1247867959.mp4&thumbnailURL=http://cdn.jivox.com/47863/3/24238-61450-ivd522439b1f3bae-tn.jpg&videoWidth=340&videoHeight=192&autoPlay=true&eventId=111&actionButtonId=customInteraction.custom111&es_pId=&jvxSessionId=1380317264.9409&closeWhenDone=0&null&clickThroughURL=http%3A%2F%2Fadclick.g.doubleclick.net%2Faclk%3Fsa%3DL%26ai%3DB4Z7GUPhFUpLQE-vP0AG93ICIDaqowo0EAAAAEAEgwqCnDjgAWOqL5uphYMnGqYvApNgPsgEWd3d3LmNvc21vZW5lc3Bhbm9sLmNvbboBCzAwZ2ZwX2ltYWdlyAEJ2gEmaHR0cDovL3d3dy5jb3Ntb2VuZXNwYW5vbC5jb20vZmFzaGlvbi-pAo2ngfDMYXQ-wAIC4AIA6gI-LzcxODcvdGVsZXZpc2EuZWRpdG9yaWFsLmNvc21vZW5lc3Bhbm9sL2Nvc21vZW5lc3Bhbm9sLmZhc2hpb274AoHSHpAD4AOYA6QDqAMB0ASQTuAEAaAGIA%26num%3D0%26sig%3DAOD64_1auFdJJrgb5qh-EFPUxfZCfZCLWw%26client%3Dca-pub-7798366957477628%26adurl%3Dhttp%3A%2F%2Fwww.MiPantene.com" width="301" height="170" id="custom111PlaceHolder" style="visibility: visible;"><param name="wmode" value="transparent"></object></div></div>
</div> <!-- scenes container ends -->



<script>
var eventTargetMap = {};
</script>

<!-- Sync Related Code -->
<!-- Sync Related Code Ends -->

<script language="javascript" type="text/javascript">

//pass the sec video modal window XY coordinates. This would return the close button for the modal window with bottom right alignment.
function getSecVideoCloseBtnXY(modalWinXY){
	var secVideoCloseBtnX = modalWinXY[0] + parseInt(secVideoWidth);
	secVideoCloseBtnX = secVideoCloseBtnX - parseInt(24);
	var secVideoCloseBtnY = modalWinXY[1] + parseInt(secVideoHeight);
	secVideoCloseBtnY = secVideoCloseBtnY - parseInt(24);
	return [secVideoCloseBtnX,secVideoCloseBtnY];
}
var secVideoWidth = '300';
var secVideoHeight = '250';
var secVideoModalWinSize = [0,0];
var secVideoModalWinXY = [0,0];
var secVideoCloseBtnXY = [0,0];

function setSecVideoModalWinDetails(){
	secVideoWidth = '300';
    secVideoHeight = '250';
	secVideoModalWinSize = [window.innerWidth-100,window.innerHeight-100];
	if(secVideoWidth != '' && secVideoHeight != ''){
		secVideoModalWinSize = getOutputWinSize([parseInt(secVideoWidth),parseInt(secVideoHeight)],'video');
	}
	secVideoWidth = secVideoModalWinSize[0];
	secVideoHeight = secVideoModalWinSize[1];
	secVideoModalWinXY = getCenterAlignXY(secVideoWidth,secVideoHeight);	
	secVideoCloseBtnXY = getSecVideoCloseBtnXY(secVideoModalWinXY);
}


function getBestPossibleOutputWinCanvas(resizedAssetDim,aspectRatio){
	var tmpWidth = resizedAssetDim[0];
	var tmpHeight = resizedAssetDim[1];
	if(tmpWidth >= tmpHeight){//landscape asset
		if(tmpWidth > defaultOutputWinWidth || tmpHeight > defaultOutputWinHeight){
			tmpWidth = tmpWidth - 10;
			tmpHeight = Math.round(tmpWidth / aspectRatio);			
			return getBestPossibleOutputWinCanvas([tmpWidth,tmpHeight],aspectRatio);
		} 
	} else {// portait asset
		if(tmpWidth > defaultOutputWinWidth || tmpHeight > defaultOutputWinHeight){
			tmpHeight = tmpHeight - 10;
			tmpWidth = Math.round(tmpHeight * aspectRatio);
			return getBestPossibleOutputWinCanvas([tmpWidth,tmpHeight],aspectRatio);
		}
	}
	return [tmpWidth,tmpHeight];
}

function getControlBarHeight(assetHeight){
	return Math.round((26 * assetHeight) / 224);
}

function getOutputWinSize(assetDim,assetFileType){ //return the output window dimension from output content dimension
	var outputWinDim = assetDim ? eval(assetDim) : [1024,768];	// assetDim might not be available for youtube/widget etc.,
	var assetWidth = outputWinDim[0];
	var assetHeight = outputWinDim[1];
	var controlBarHeight = 0;
	var aspectRatio = assetWidth / assetHeight;	
	if(assetWidth < defaultOutputWinWidth && assetHeight < defaultOutputWinHeight){
		
	}else{			
		if(assetWidth > assetHeight){		
			//alert(defaultOutputWinWidth + ":::" + defaultOutputWinHeight);
			outputWinDim[0] = defaultOutputWinWidth;
			outputWinDim[1] = Math.round(outputWinDim[0] / aspectRatio);
		}else{	
			outputWinDim[1] = defaultOutputWinHeight;
			outputWinDim[0] = Math.round(outputWinDim[1] * aspectRatio);
		}
		if(outputWinDim[0] <= defaultOutputWinWidth && outputWinDim[1] <= defaultOutputWinHeight){ // derived dimensions are less than layout canvas	
			
		}else{//find the best output canvas size within layout canvas
			outputWinDim = getBestPossibleOutputWinCanvas(outputWinDim,aspectRatio);
		}
	}
	if(assetFileType == 'video'){
		controlBarHeight = getControlBarHeight(outputWinDim[1]);
	}
	outputWinDim[1] = outputWinDim[1]+ controlBarHeight;
	return outputWinDim;
}

function getOutputWinPosn(outputWinDim){
	var outputWinDim = eval(outputWinDim);
	var outputWinLeft = Math.round((adUnitWidth/2) - (outputWinDim[0]/2));
	var outputWinTop = Math.round((adUnitHeight/2) - (outputWinDim[1]/2));
	return [outputWinTop,outputWinLeft];
}

// This method is called when an event happens on AB like click/hover.
function abMsg(msg){
	notifyEventFramework(msg);
	}

function receiveRelayMessage(msg) {
	var objId = msg.split(".")[0];
	var status = msg.split(".")[1];
	switch(status){
		case "playing":
			handlePlaying(objId);
			break;
		case "finished":
			handleFinished(objId);
			break;
		default:
			notifyEventFramework(msg);
			break;
	}

	handleMsg(msg);

		
	
}

function notifyEventFramework(msg){
	
	$('#eventHandler').trigger(msg, ['event', msg]);
}

function handleMsg(msg){
	
	if(eventTargetMap[msg]){
		var actions = eventTargetMap[msg]['actions'];
		for(var action in actions){
			var targets = actions[action]['targets'];
			var targetsArr = targets.split(',');
			for(var i in targetsArr){
				var target = targetsArr[i];
				if(action == 'invokeAfter'){
					invokeActionButton(target);
					invokeTrigger(target);
				}
				else if(action == 'showAfter'){
					showActionButton(target);
				}
				else if(action == 'hideAfter'){
					hideActionButton(target);
				}
			}
		}
	}
}

function handlePlaying(activeVideoId){
	activeVideoIdInScene = activeVideoId;
		pauseAllVideosExceptActive(activeVideoId);
	if(expandUnitOpen == false) {
		pauseAllVideos();
	}
	}

function handleFinished(objId){
	//Hide in-place video once finished playing (if close when done param is passed)
	if(objId != "player" && videoElementsInScene.hasOwnProperty(objId)) { // making sure its in-place video
		$('#' + objId).hide();
		if(thisBrowser == 'iPad') {
			$("#"+objId).css({'opacity':0, 'display':'block'});
			$("#"+objId).contents().find("div.videoWrapper").addClass("forceVideoHidden");
		} 
	}
}

/*
When a specific video id is passed to this method that will be ignored from pausing. 
If video id is not passed, all videos will be paused.
*/
function pauseAllVideosExceptActive(activeVideoId){
	for(var videoId in videoElementsInScene){
		if(activeVideoId == videoId)
			continue;
		if(videoId == "player"){ //special handling for primary player
			pauseHTML5orFlashAd(); 
		}else{
			pauseInPlaceVideo(videoId);
		}
	}
}


/*
Sends request to all videos to pause. If videos that are passed already would ignore these requests.
*/
function pauseAllVideos(){
		for(var videoId in videoElementsInScene){
		if(videoId == "player"){ //special handling for primary player
			pauseHTML5orFlashAd(); 
		}else{
			pauseInPlaceVideo(videoId);
		}
	}
	}

function closeActionBtnDetailPanel(actionBtnCloseClicked){
	if(actionButtonEventId == '') return;

	//remove glow class from AB when its OW is closed
	$('#custom'+ actionButtonEventId).removeClass('shadowGlowcustom' + actionButtonEventId); 

	var actionButtonCloseEventId = parseInt(actionButtonEventId) + parseInt(200);
		//record impression for custom interaction.
	fireExternalTracker("http://evs.jivox.com/jivox/serverAPIs/saveImpression.php?" + serialize({"campaignId":"47863", "siteId" : "2521715ca13bed", "clickThrough" : actionButtonCloseEventId, "jvxSessionId" : 1380317264.9409, "elapsedTime" : actionBtnTimeElapsed, "adUnitType" : "9", "es_pId" : ""}));
		$('#actionBtnLaunchPad').attr("src", "http://as.jivox.com/player/blank.html");
	$('#closeActionBtnLaunchPad').hide();
	$('#actionBtnLaunchPad').hide().css({"top":"0px","left":"0px","width":"0px","height":"0px"});
	$("#mask").hide();
	var controlType = $("#closeActionBtnLaunchPad").attr("controlType");
	clearInterval(actionBtnPanelTimer);
	//reset the timer
	actionBtnTimeElapsed = 0;
	actionButtonEventId = '';
	if(outputWindowType == 'default' || outputWindowType == 'overlayPlayer' || controlType == "video"){
		//resume ad only when action button close clicked
		if(activeVideoIdInScene == "player"){			
						jvxAdPlayer_5245f850874f99_49863897.autoSlideInInteractivity(null,null);
				
		}
		resumeVideo(activeVideoIdInScene);
	}

}

function getWinSize(){
	var w = 0;
	var h = 0;

	//IE
	if(window.innerWidth == null ||  window.innerWidth == undefined)
	{
		//strict mode
		if(!(document.documentElement.clientWidth == 0))
		{
			w = document.documentElement.clientWidth;
			h = document.documentElement.clientHeight;
		}
		//quirks mode
		else
		{
			w = document.body.clientWidth;
			h = document.body.clientHeight;
		}
	}
	//w3c
	else
	{
		w = window.innerWidth;
		h = window.innerHeight;
	}

	return [w,h];
}


function activateScene(){
	resumeVideo(activeVideoIdInScene);	
	setABTransitionTimers();
}

function deactivateScene(){
    closeActionBtnDetailPanel(false);
	stopSecondaryVideo();
	pauseAllVideos();
    pauseABTransitions();
}

function pauseHTML5orFlashAd(){
	try{
				jvxAdPlayer_5245f850874f99_49863897.pauseAd();
			}catch(e){

	}
}

function pauseVideo(videoId){
	if(videoId == "") return;
	if(videoId == "player"){
		pauseHTML5orFlashAd();
	}else{
		pauseInPlaceVideo(videoId);
	}
}

function resumeHTML5orFlashAd(){
	try{
		jvxAdPlayer_5245f850874f99_49863897.resumeAd();
		}catch(e){

	}
}

function resumeVideo(videoId){
	if(videoId == "") return;
	if(videoId == "player"){
		resumeHTML5orFlashAd();
	}else{
		resumeInPlaceVideo(videoId);
	}
}

function resizeIPanelAttr(){
    var panelWidth = parseInt($("#interactivity_panel").width());
    var panelHeight = parseInt($("#interactivity_panel").height());
    var panelTop = parseInt($("#interactivity_panel").css("top").replace("px", ""));
    var panelLeft = parseInt($("#interactivity_panel").css("left").replace("px", ""));
	var panelZindex = parseInt($("#interactivity_panel").css("z-index"));
	var playerZindex = parseInt($("#player").css("z-index"));
    var windowWidth = $(window).width();
    var windowHeight = $(window).height();
    var iPanelWidth = 301;
    var iPanelHeight = 250;
    var iPanelNewAttr = new Object;
    var iPanelOrgAttr = new Object;
    iPanelOrgAttr.width = panelWidth;
    iPanelOrgAttr.height = panelHeight;
    iPanelOrgAttr.top = panelTop;
    iPanelOrgAttr.left = panelLeft;
	iPanelOrgAttr.panelzindex = panelZindex;
	iPanelOrgAttr.playerzindex = playerZindex;

	iPanelNewAttr.panelzindex = 10;
	iPanelNewAttr.playerzindex = 10;

    if(panelWidth < iPanelWidth){
           var availableSpaceX = windowWidth - (panelLeft + panelWidth);
           if(availableSpaceX >=  (iPanelWidth - panelWidth)){
               iPanelNewAttr.width = 301;
           }else{
               iPanelNewAttr.left =  (windowWidth <= iPanelWidth) ? 0 : (panelLeft - (iPanelWidth - panelWidth));
               iPanelNewAttr.width = 301;
           }
    }

    if(panelHeight < iPanelHeight){
        var availableSpaceY = windowHeight - (panelTop + panelHeight);
        if(availableSpaceY >=  (iPanelHeight - panelHeight)){
            iPanelNewAttr.height =  250;
        }else{
        	iPanelNewAttr.top =  (windowHeight <= iPanelHeight) ? 0 : (panelTop - (iPanelHeight - panelHeight));
            iPanelNewAttr.height =  250;
        }
    }

    return [iPanelOrgAttr, iPanelNewAttr];
}

function getFlashMovieObject(movieName){
	if (window.document[movieName])
	{
	  return window.document[movieName];
	}

	if (navigator.appName.indexOf("Microsoft Internet")==-1)
	{
		if (document.embeds && document.embeds[movieName])
			return document.embeds[movieName];
		else
			 return document.getElementById(movieName);
	}
	else // if (navigator.appName.indexOf("Microsoft Internet")!=-1)
	{
		return document.getElementById(movieName);
	}
}

/* 
Public API method that can be invoked from SWF / Widget with their action button id.
When this method is called, all the elements attached to this action button trigger 
will start appearing / disappearing.
*/
function invokeTrigger(s){
	var actionBtnId = s.replace('customInteraction.', '');
	layout.invokeSecondaryAction(actionBtnId);
	 // execute event related code only at campaign level
	var actionBtnCompleteId = layout.getCompleteActionButtonId(actionBtnId);
	var actionBtnDetails = actionButtonsJSON[actionBtnCompleteId];
	var clickActionType = actionBtnDetails['type'];
	if(clickActionType == "trigger"){ // for trigger type action buttons record the event
		layout.fireABEvent(actionBtnId);
	}
	}

</script>
<script type="text/javascript">
var playInterval = null;
var startInterval = null;
var pauseInterval = null;
var timeElapsed = 0;
var panelTimer = null;
var secVideoPanelTimer = null;
var secVideoTimeElapsed = 0;
var secVideoEventId = null;
var timeoutCounter = 0;
var adStarted = false;
var secVideoOpen = false;
var elementsLoadedTimer = null;
    
    $(document).ready(function(){
        
		if(thisBrowser == 'iPad') {
			expandUnitOpen = true;
		}

        //we don't have video time in case of expanded ad unit
        //so start the timer once panel is ready
        panelTimer = setInterval(function(){ timeElapsed = timeElapsed+1; }, 1000);

        
    	        $(".baseContainer").click(function(){
            window.open("http://adclick.g.doubleclick.net/aclk?sa=L&ai=B4Z7GUPhFUpLQE-vP0AG93ICIDaqowo0EAAAAEAEgwqCnDjgAWOqL5uphYMnGqYvApNgPsgEWd3d3LmNvc21vZW5lc3Bhbm9sLmNvbboBCzAwZ2ZwX2ltYWdlyAEJ2gEmaHR0cDovL3d3dy5jb3Ntb2VuZXNwYW5vbC5jb20vZmFzaGlvbi-pAo2ngfDMYXQ-wAIC4AIA6gI-LzcxODcvdGVsZXZpc2EuZWRpdG9yaWFsLmNvc21vZW5lc3Bhbm9sL2Nvc21vZW5lc3Bhbm9sLmZhc2hpb274AoHSHpAD4AOYA6QDqAMB0ASQTuAEAaAGIA&num=0&sig=AOD64_1auFdJJrgb5qh-EFPUxfZCfZCLWw&client=ca-pub-7798366957477628&adurl=http://www.MiPantene.com");
			//invoke clickTrackerURLs
			
                        //record impression for clickThroughUrl interaction.
            fireExternalTracker("http://evs.jivox.com/jivox/serverAPIs/saveImpression.php?" + serialize({"campaignId":"47863", "siteId" : "2521715ca13bed", "clickThrough":"1", "jvxSessionId" : "1380317264.9409", "elapsedTime": timeElapsed, "adUnitType" : "9", "es_pId" : ""}));
                                });
		
        $(".closeSecondaryVideo").live("click",function(){
            stopSecondaryVideo(true);
			resumeVideo(activeVideoIdInScene);
        });

		$('#closeActionBtnLaunchPad').click(function(){
			closeActionBtnDetailPanel(true);
		});

                $(window).load(function(){
              if(elementsRendered){
				 startAd();
			   } else {
		 		 elementsLoadedTimer = setInterval(function(){if(elementsRendered){clearInterval(elementsLoadedTimer);startAd();}},1000);
				}
        });
        
    });

    
	
    function startAd(){
                var winWidth = getWinSize()[0];
		//Fix for BUG ID: ADPTL-4807
        		expandUnitOpen = false;
		if(winWidth >= 638){
			expandUnitOpen = true;
	        try{
				if(isPlayerInLayoutScene){
	        		jvxAdPlayer_5245f850874f99_49863897.startAd();
				}

								if(abTransitionJSONPopulated && transitionTimersArray.length == 0){
					setABTransitionTimers();
				}else{
					var abTransitionJSONTimer = setInterval(function(){
						if(abTransitionJSONPopulated && transitionTimersArray.length == 0){
							clearInterval(abTransitionJSONTimer);
							setABTransitionTimers();
						}else if(abTransitionJSONPopulated && transitionTimersArray.length > 0){
							clearInterval(abTransitionJSONTimer);
						}
					}, 500);
				}
				
	        		        	adStarted = true;
	        	if(startInterval != null){
	                clearInterval(startInterval);
	            }
				
	            pauseInterval = setInterval(pauseAd, 200);
	        }catch(e){
	            	            if(timeoutCounter <= 2){
	                timeoutCounter = timeoutCounter+1;
	                setTimeout(function(){startAd()}, 200);
	            }else{
	                timeoutCounter = 0;
	            }
	        }
        }else if(!adStarted){
            if(startInterval != null){
                clearInterval(startInterval);
            }
            startInterval = setInterval(startAd, 200);
        }
    }
    
    function pauseAd(){
        var winWidth = getWinSize()[0];
        if(winWidth < 640){
                        stopSecondaryVideo();
			closeActionBtnDetailPanel(false);
			expandUnitOpen = false;
            try{
                				
				pauseAllVideos();

				pauseABTransitions(); // pause AB transitions.

                if(pauseInterval != null)
                    clearInterval(pauseInterval);
                playInterval = setInterval(playAd, 200);
            }catch(e){
                                if(timeoutCounter <= 2){
                    timeoutCounter = timeoutCounter+1;
                }else{
                	clearInterval(pauseInterval);
                	timeoutCounter = 0;
                }
            }
        }
    }

    function playAd(){
        var winWidth = getWinSize()[0];
        if(winWidth >= 640){
            			expandUnitOpen = true;
            try{
				                				
								if(abTransitionJSONPopulated && transitionTimersArray.length == 0){
					setABTransitionTimers();
				}else{
					var abTransitionJSONTimer = setInterval(function(){
						if(abTransitionJSONPopulated && transitionTimersArray.length == 0){
							clearInterval(abTransitionJSONTimer);
							setABTransitionTimers();
						}else if(abTransitionJSONPopulated && transitionTimersArray.length > 0){
							clearInterval(abTransitionJSONTimer);
						}
					}, 500);
				}
				
				if(isPlayerInLayoutScene){
					resumeHTML5orFlashAd();
									}
				//Fix for PBPTL-798 - non click-able play button
								if(isInPlaceVideoInScene) {
					for(var videoId in videoElementsInScene){
						if(videoId == "player") continue;
						var inPlaceVideoAutoPlay = videoElementsInScene[videoId]['autoPlay'];
						if(inPlaceVideoAutoPlay){
							if(activeVideoIdInScene != ""){
							   resumeInPlaceVideo(activeVideoIdInScene); // resume the video that was paused during re-expansion
							} else {
							   resumeInPlaceVideo(videoId); 
							}
						}
						//Fixed - non click-able play button
						$("#"+videoId).css("left", (parseInt($("#"+videoId).css("left"))+1)+"px");
						//
						//Fixed - controls not visible, video shown in freezed state
												//
						setTimeout((function(videoId){
							return function(){
								$("#"+videoId).css("left", (parseInt($("#"+videoId).css("left"))-1)+"px");
															}
						})(videoId), 50);
					}
				}
								//
                pauseInterval = setInterval(pauseAd, 200);
                if(playInterval != null)
                    clearInterval(playInterval);
            }catch(e){
                                if(timeoutCounter <= 2){
                    timeoutCounter = timeoutCounter+1;
                }else{
                	clearInterval(playInterval);
                	timeoutCounter = 0;
                }
            }
        }
    }
    	
	
	function playSecondaryVideo(key,eventId){
		secVideoOpen = true;
		secVideoPanelTimer = setInterval(function(){ secVideoTimeElapsed = secVideoTimeElapsed+1; }, 1000);		
		secVideoEventId = eventId;
		var secVideoPlayerWidth = 300;
		var secVideoPlayerHeight = 250;
		if(!isPlayerInLayoutScene){		
			setSecVideoModalWinDetails();
			if($("#secondaryVideo").length == 0){
				$('body').append('<iframe id="secondaryVideo" src="blank.html" width="'+secVideoWidth+'" height="'+secVideoHeight+'" frameborder="0" scrolling="no" style="position:absolute;top:'+secVideoModalWinXY[1]+'px;left:'+secVideoModalWinXY[0]+'px;display:none;z-index:9999999999;background:#000;"></iframe><div class="closeSecondaryVideo" style="position:absolute;z-index:9999999999;left:'+secVideoCloseBtnXY[0]+'px;top:'+secVideoCloseBtnXY[1]+'px;"></div>');
			}else{
				$("#secondaryVideo").css({'left':secVideoModalWinXY[0] + 'px','top':secVideoModalWinXY[1] + 'px'});
				$(".closeSecondaryVideo").css({'left':secVideoCloseBtnXY[0] + 'px','top':secVideoCloseBtnXY[1] + 'px'});
			}
			secVideoPlayerWidth = secVideoWidth;
			secVideoPlayerHeight = secVideoHeight;
		} else { 
			// Fix for http://mycroft.jivox.com:8080/browse/ADPTL-5075
			if($("#secondaryVideo").length == 0){
				// we need to use Back To Video Icon for close when sec video is opened on top of player. So add backToVideo class.
				$('<div class="closeSecondaryVideo backToVideo"></div>').appendTo('#player');
				$('<iframe id="secondaryVideo" src="blank.html" width="'+playerWidth+'" height="'+playerHeight+'" frameborder="0" scrolling="no" style="position:absolute; display: none; z-index:10; background:#000;top:0px;left:0px;"></iframe>').appendTo('#player');
			}else{
				// we need to use Back To Video Icon for close when sec video is opened on top of player. So override default 'X' text inside the div.
				$(".closeSecondaryVideo").addClass('backToVideo');				
			}
			secVideoPlayerWidth = playerWidth;
			secVideoPlayerHeight = playerHeight;

					}
        $("#secondaryVideo").show();
        $(".closeSecondaryVideo").show();
        $("#secondaryVideo").attr("src", "http://as.jivox.com/player/customInteraction.php?id=47863&expandAsInterstitial=1&t=1380317264318&r=0.4445457870606333&creativeUnitType=14&creativeUnitWidth=640&creativeUnitHeight=480&siteId=2521715ca13bed&campaignId=47863&clickTagURL=http%3A%2F%2Fadclick.g.doubleclick.net%2Faclk%3Fsa%3DL%26ai%3DB4Z7GUPhFUpLQE-vP0AG93ICIDaqowo0EAAAAEAEgwqCnDjgAWOqL5uphYMnGqYvApNgPsgEWd3d3LmNvc21vZW5lc3Bhbm9sLmNvbboBCzAwZ2ZwX2ltYWdlyAEJ2gEmaHR0cDovL3d3dy5jb3Ntb2VuZXNwYW5vbC5jb20vZmFzaGlvbi-pAo2ngfDMYXQ-wAIC4AIA6gI-LzcxODcvdGVsZXZpc2EuZWRpdG9yaWFsLmNvc21vZW5lc3Bhbm9sL2Nvc21vZW5lc3Bhbm9sLmZhc2hpb274AoHSHpAD4AOYA6QDqAMB0ASQTuAEAaAGIA%26num%3D0%26sig%3DAOD64_1auFdJJrgb5qh-EFPUxfZCfZCLWw%26client%3Dca-pub-7798366957477628%26adurl%3Dhttp%3A%2F%2Fwww.MiPantene.com&objectName=jvxAdPlayer_5245f850874f99_49863897&lDim=640x480&expandUnitType=&adUnitType=9&expandedUnit=1&viewLayout=&adUnitWidth=640&adUnitHeight=480&jvxSessionId=1380317264.9409&height="+ secVideoPlayerHeight +"&width="+ secVideoPlayerWidth +"&key=" + key);

		closeActionBtnDetailPanel(false);

		pauseAllVideos();

		if(!isPlayerInLayoutScene){
			$('#mask').show();
		}
    }

    function stopSecondaryVideo(recordSecVideoCloseEvent){
		if(!secVideoOpen)
			return;
		if(!isPlayerInLayoutScene){
			$('#mask').hide();
		}
		if(recordSecVideoCloseEvent){
				if(secVideoEventId != null){
			var secVideoCloseEventId = parseInt(secVideoEventId) + parseInt(200);
		}
		//record impression for the custom interaction with elapsed time.
		$.get("/jivox/serverAPIs/saveImpression.php", {"campaignId":"47863", "siteId" : "2521715ca13bed", "clickThrough" : secVideoCloseEventId, "jvxSessionId" : 1380317264.9409, "elapsedTime" : secVideoTimeElapsed, "adUnitType" : "9", "es_pId" : "", "r" : $.now()} );
		clearInterval(secVideoPanelTimer);
		secVideoTimeElapsed = 0;
				}
        $("#secondaryVideo").hide();
        $(".closeSecondaryVideo").hide();
        var urlRegExp = new RegExp(regExpEscape("blank.html"));
        if(!urlRegExp.test($("#secondaryVideo").attr("src"))){
            $("#secondaryVideo").attr("src", "blank.html");
        }
		secVideoOpen = false;
    }
    
    function regExpEscape(str)
    {
      var specials = new RegExp("[.*+?|()\&\$\\[\\]{}\\\\]", "g"); // .*+?|()[]{}\
      return str.replace(specials, "\\$&");
    }
    
    /* Function to create a cookie */
    function createCookieObj(name,value,days,domainPath) {
        if (days) {
                var date = new Date();
                date.setTime(date.getTime()+(days*24*60*60*1000));
                var expires = "; expires="+date.toGMTString();
        } else {
            var expires = "";
        }
        document.cookie = name+"="+value+expires+"; path=/; domain="+domainPath;
    };
    
    /* Function to delete a cookie */
    
    function eraseCookieObj(name) {
            createCookieObj(name,"",-1,".jivox.com");
    };
    
    /* function to read cookie val */
    function readCookieObj(name) {
        var nameEQ = name + "=";
        var ca = document.cookie.split(';');
    
        for(var i=0;i < ca.length;i++) {
            var c = ca[i];
            while (c.charAt(0)==' ') c = c.substring(1,c.length);
            if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
        }
        
        return null;
    };

    function setRetargetingCookie(name, value, days, domain){
        days = days || "365";
        domain = domain || ".jivox.com";
        var existingCookieVal = readCookieObj(name);
        if(existingCookieVal != null){
            createCookieObj(name, value + "::" + existingCookieVal, days, domain);
        }else{
            createCookieObj(name, value, days, domain);
        }
    };
    // called from swf action panels
    function invokeActionButton(s){
        //console.log("JS: invokeActionButton(" + s + ")");
        //$("img#" + s.replace('customInteraction.', '')).click();
		var actionBtnId = s.replace('customInteraction.', '');
		layout.launchOutputWin(actionBtnId);
    }
    function closeActionButton(bResume){
        if(bResume == "undefined")
            bResume = true;
        closeActionBtnDetailPanel(bResume);
    }
    
</script> 



</body></html>